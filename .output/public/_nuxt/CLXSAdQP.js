import{f as P,v as S,u as z,g as u,H as D,h as K,c as l,a as s,b as x,w as L,k as e,t as c,n as k,z as A,A as H,F as R,l as V,K as O,m as T,d as G,j as J,e as Q,r as W,o as i,B as X,p as Y}from"./CCeOfYC8.js";import Z from"./CntGVgX6.js";import{u as ee}from"./B9jFdIe5.js";import"./B3ebZBhz.js";const te={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},se={class:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},ae={class:"container mx-auto px-4 py-6"},re={class:"flex items-center space-x-4"},oe={class:"flex items-center space-x-3"},ie={class:"w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center"},ne=["src","alt"],le={key:1,class:"text-white font-medium"},de={class:"text-2xl font-bold text-gray-900 dark:text-white"},ue={class:"text-sm text-gray-600 dark:text-gray-400"},ce={class:"container mx-auto px-4 py-8"},me={class:"mb-8"},ge={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4"},pe={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},ve={class:"flex-1 max-w-md"},be={class:"relative"},he={class:"flex space-x-2"},xe=["onClick"],fe={key:0,class:"flex items-center justify-center py-12"},ye={key:1,class:"rounded-md bg-red-50 dark:bg-red-900/20 p-4 mb-8"},_e={class:"flex"},we={class:"ml-3"},ke={class:"mt-2 text-sm text-red-700 dark:text-red-300"},Ce={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},qe={key:3,class:"text-center py-12"},$e={class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},Me={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},Ae={key:0,class:"mt-6"},Re={key:4,class:"text-center mt-8"},Ve=["disabled"],Ne=P({__name:"reviews",setup(Te){const d=S().params.username;z({title:`Critiques de ${d} - Anime-Kun V2`,meta:[{name:"description",content:`Toutes les critiques publiées par ${d} sur Anime-Kun`}]});const C=J(),{getAvatarUrl:U}=ee(),f=u(!1),b=u(!1),y=u(""),p=u([]),n=u(null),h=u(0),q=u(!0),_=u(1),$=u(!1),o=u({search:"",type:"all",sort:"recent"}),B=[{value:"all",label:"Toutes"},{value:"anime",label:"Animes"},{value:"manga",label:"Mangas"}],w=D(()=>!!(o.value.search||o.value.type!=="all"||o.value.sort!=="recent"));let M;const E=()=>{clearTimeout(M),M=setTimeout(()=>{v()},500)},v=async(t=!1)=>{try{t?b.value=!0:(f.value=!0,_.value=1),y.value="";const a=new URLSearchParams({page:_.value.toString(),limit:"12",sort:o.value.sort});o.value.search&&a.append("search",o.value.search),o.value.type!=="all"&&a.append("type",o.value.type);const m=await $fetch(`${C.public.apiBase}/api/users/public/${d}/reviews?${a}`),g=m.reviews||[];if(t?p.value.push(...g):p.value=g,h.value=m.total||g.length,q.value=g.length===12&&p.value.length<h.value,!n.value&&g.length>0){const r=await $fetch(`${C.public.apiBase}/api/users/public/${d}`);n.value=r.user}}catch(a){y.value=a.message||"Erreur lors du chargement des critiques",console.error("Error loading user reviews:",a)}finally{f.value=!1,b.value=!1}},I=async()=>{_.value++,await v(!0)},j=()=>{o.value={search:"",type:"all",sort:"recent"},v()},F=t=>({id:t.id||t.idCritique,idCritique:t.idCritique||t.id,niceUrl:t.niceUrl,titre:t.titre,critique:t.critique||t.contenu,notation:t.notation||t.note,dateCritique:t.reviewDate||t.dateCritique||t.dateCreation,statut:typeof t.statut=="number"?t.statut:1,idMembre:t.idMembre||t.userId||0,idAnime:t.idAnime||t.animeId||0,idManga:t.idManga||t.mangaId||0,nbClics:t.nbClics||t.nbVues||0,anime:t.anime,manga:t.manga,membre:t.membre||{id:n.value?.id,pseudo:n.value?.pseudo||d,avatar:n.value?.avatar}}),N=t=>{Y(`/review/${t.id||t.idCritique}`)};return K(()=>{v()}),(t,a)=>{const m=W("Icon"),g=Q;return i(),l("div",te,[s("div",se,[s("div",ae,[s("div",re,[x(g,{to:`/user/${e(d)}`,class:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"},{default:L(()=>[x(m,{name:"heroicons:arrow-left",class:"w-5 h-5"})]),_:1},8,["to"]),s("div",oe,[s("div",ie,[e(n)?.avatar&&!e($)?(i(),l("img",{key:0,src:e(U)(e(n).avatar),alt:e(n)?.pseudo||e(d),class:"w-full h-full object-cover rounded-full",onError:a[0]||(a[0]=r=>$.value=!0)},null,40,ne)):(i(),l("span",le,c((e(n)?.pseudo||e(d)).charAt(0).toUpperCase()),1))]),s("div",null,[s("h1",de," Critiques de "+c(e(n)?.pseudo||e(d)),1),s("p",ue,c(e(h))+" critique"+c(e(h)!==1?"s":"")+" publiée"+c(e(h)!==1?"s":""),1)])])])])]),s("div",ce,[s("div",me,[s("div",ge,[s("div",pe,[s("div",ve,[s("div",be,[x(m,{name:"heroicons:magnifying-glass",class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),A(s("input",{"onUpdate:modelValue":a[1]||(a[1]=r=>e(o).search=r),type:"text",placeholder:"Rechercher dans les critiques...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",onInput:E},null,544),[[H,e(o).search]])])]),s("div",he,[(i(),l(R,null,V(B,r=>s("button",{key:r.value,onClick:Be=>{e(o).type=r.value,v()},class:X(["px-4 py-2 text-sm font-medium rounded-md border transition-colors",e(o).type===r.value?"bg-blue-600 text-white border-blue-600":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600"])},c(r.label),11,xe)),64))]),A(s("select",{"onUpdate:modelValue":a[2]||(a[2]=r=>e(o).sort=r),onChange:a[3]||(a[3]=r=>v()),class:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"},a[4]||(a[4]=[s("option",{value:"recent"},"Plus récentes",-1),s("option",{value:"rating_desc"},"Mieux notées",-1),s("option",{value:"rating_asc"},"Moins bien notées",-1),s("option",{value:"views"},"Plus vues",-1)]),544),[[O,e(o).sort]])])])]),e(f)?(i(),l("div",fe,a[5]||(a[5]=[s("div",{class:"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent"},null,-1),s("span",{class:"ml-3 text-gray-600 dark:text-gray-300"},"Chargement des critiques...",-1)]))):e(y)?(i(),l("div",ye,[s("div",_e,[x(m,{name:"heroicons:exclamation-triangle",class:"h-5 w-5 text-red-400"}),s("div",we,[a[6]||(a[6]=s("h3",{class:"text-sm font-medium text-red-800 dark:text-red-200"}," Erreur de chargement ",-1)),s("div",ke,c(e(y)),1)])])])):e(p).length?(i(),l("div",Ce,[(i(!0),l(R,null,V(e(p),r=>(i(),T(Z,{key:r.id||r.idCritique,review:F(r),onView:N},null,8,["review"]))),128))])):(i(),l("div",qe,[x(m,{name:"heroicons:document-text",class:"mx-auto h-12 w-12 text-gray-400"}),s("h3",$e,c(e(w)?"Aucune critique trouvée":"Aucune critique publiée"),1),s("p",Me,c(e(w)?"Essayez de modifier vos filtres.":`${e(n)?.pseudo||e(d)} n'a pas encore publié de critiques.`),1),e(w)?(i(),l("div",Ae,[s("button",{onClick:j,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"}," Effacer les filtres ")])):k("",!0)])),!e(f)&&e(p).length&&e(q)?(i(),l("div",Re,[s("button",{onClick:I,disabled:e(b),class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50"},[e(b)?(i(),T(m,{key:0,name:"heroicons:arrow-path",class:"w-4 h-4 animate-spin mr-2"})):k("",!0),G(" "+c(e(b)?"Chargement...":"Charger plus de critiques"),1)],8,Ve)])):k("",!0)])])}}});export{Ne as default};
