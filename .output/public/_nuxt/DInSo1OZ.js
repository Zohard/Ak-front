import{u as j,a as N}from"./DX7MLR6s.js";import{f as $,g as i,H as b,h as E,Y as V,G as L,c,n as f,k as a,B as g,a as m,b as z,aa as T,N as U,r as F,o as d,_ as G}from"./Bes98wj2.js";const H={class:"absolute inset-0 flex items-center justify-center"},P={class:"text-center"},W=["src","alt","loading","decoding","sizes","srcset"],Y={key:3,class:"absolute inset-0"},A=$({__name:"SmartImage",props:{src:{},alt:{},aspectRatio:{},lazy:{type:Boolean,default:!0},loading:{default:"lazy"},decoding:{default:"async"},placeholderIcon:{default:"heroicons:photo"},containerClass:{default:""},imageClass:{default:""},skeletonClass:{default:""},errorClass:{default:""},sizes:{},width:{},height:{},quality:{default:85},threshold:{default:.1},rootMargin:{default:"50px"},onlyOnce:{type:Boolean,default:!0}},emits:["load","error"],setup(w,{emit:C}){const t=w,h=C,{optimizeImageUrl:p}=j(),{optimizeForConnection:I}=N(),v=I(),y=i(),_=i(),o=i(!1),s=i(!1),u=i(!t.lazy),k=i(!1);let n=null;const M=b(()=>{const e=v.connectionType==="slow-2g"||v.connectionType==="2g"?Math.min(t.quality,70):t.quality;return p(t.src,t.width,t.height,e)}),R=b(()=>{if(!t.width||!t.height)return;const e=t.width;return[1,1.5,2].map(l=>{const O=Math.round(e*l),S=Math.round(t.height*l);return`${p(t.src,O,S,t.quality)} ${l}x`}).join(", ")}),x=()=>{if(!y.value||!t.lazy||typeof window>"u"){u.value=!0;return}n=new IntersectionObserver(e=>{const[r]=e;k.value=r.isIntersecting,r.isIntersecting&&(u.value=!0,t.onlyOnce&&n&&n.disconnect())},{root:null,rootMargin:t.rootMargin,threshold:t.threshold}),n.observe(y.value)},B=e=>{o.value=!0,s.value=!1,h("load",e)},q=e=>{o.value=!1,s.value=!0,h("error",e)};return E(()=>{x()}),V(()=>{n&&n.disconnect()}),L(()=>t.src,()=>{o.value=!1,s.value=!1,t.lazy&&!k.value&&(u.value=!1)}),(e,r)=>{const l=F("Icon");return d(),c("div",{ref_key:"containerRef",ref:y,class:g(["lazy-image-container relative overflow-hidden",e.containerClass]),style:U({aspectRatio:e.aspectRatio||"auto"})},[!a(o)&&!a(s)?(d(),c("div",{key:0,class:g(["absolute inset-0 animate-pulse bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200 dark:from-gray-700 dark:via-gray-600 dark:to-gray-700",e.skeletonClass])},[m("div",H,[z(l,{name:e.placeholderIcon,class:"w-8 h-8 text-gray-400 dark:text-gray-500"},null,8,["name"])])],2)):f("",!0),a(s)&&!a(o)?(d(),c("div",{key:1,class:g(["absolute inset-0 bg-gray-100 dark:bg-gray-800 flex items-center justify-center",e.errorClass])},[m("div",P,[z(l,{name:"heroicons:photo",class:"w-8 h-8 text-gray-400 dark:text-gray-500 mx-auto mb-2"}),r[0]||(r[0]=m("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Image non disponible",-1))])],2)):f("",!0),a(u)?(d(),c("img",{key:2,ref_key:"imageRef",ref:_,src:a(M),alt:e.alt,class:g(["w-full h-full object-cover transition-opacity duration-300",e.imageClass,{"opacity-0":!a(o),"opacity-100":a(o)}]),loading:e.loading,decoding:e.decoding,onLoad:B,onError:q,sizes:e.sizes,srcset:a(R)},null,42,W)):f("",!0),e.$slots.overlay?(d(),c("div",Y,[T(e.$slots,"overlay",{loaded:a(o),error:a(s)},void 0)])):f("",!0)],6)}}}),Q=G(A,[["__scopeId","data-v-e0162b5f"]]);export{Q as default};
