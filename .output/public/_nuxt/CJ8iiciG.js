import{f as N,q as V,g as c,x as P,h as j,u as H,c as f,a as t,b as o,w as b,d as m,z as C,A as E,k as a,ac as L,K as M,t as r,F as R,l as U,j as K,e as z,r as F,o as v,B as O,_ as G}from"./CCeOfYC8.js";import{u as J}from"./B7NL00rM.js";const Q={class:"admin-layout"},W={class:"admin-sidebar"},X={class:"sidebar-section"},Y={class:"sidebar-section"},Z={class:"sidebar-section"},ss={class:"quick-links"},ts={href:"http://localhost:3003/docs",target:"_blank",class:"quick-link"},es={class:"admin-main"},ns={class:"section-header"},as={class:"card p-4 mb-4 flex gap-3 items-end"},is={key:0,class:"card p-4 text-center"},os={key:1,class:"card p-4 text-center text-red-600"},ls={key:2,class:"card overflow-x-auto"},rs={class:"table"},us={class:"flex gap-2"},ds=["onClick"],cs=["onClick"],ms={class:"mt-4 flex items-center justify-between"},ps={class:"flex items-center gap-3"},fs=["disabled"],bs=["disabled"],vs={class:"text-sm text-gray-600"},gs=N({__name:"index",setup(hs){const y=K(),k=V(),{success:_,error:w}=J(),B=c([]),x=c(!1),g=c(null),l=c(1);c(20);const h=c(1),$=c(0),i=P({search:"",type:"",statut:void 0}),d=async()=>{try{x.value=!0,g.value=null;const e={};l.value>1&&(e.page=l.value),i.search?.trim()&&(e.search=i.search.trim()),i.type?.trim()&&(e.type=i.type.trim()),typeof i.statut=="number"&&(e.statut=i.statut);const s=await $fetch(`${y.public.apiBase}/api/admin/business`,{params:e,headers:k.getAuthHeaders()});B.value=s.items||[];const u=s.pagination||{};l.value=u.page||1,h.value=u.totalPages||1,$.value=u.total||0,l.value===1&&!i.search&&!i.type&&typeof i.statut!="number"&&_(`${$.value} entreprises chargées avec succès`,{duration:3e3})}catch(e){g.value=e?.data?.message||"Erreur lors du chargement des entreprises",console.error("Error loading business:",e)}finally{x.value=!1}},A=e=>{e>=1&&e<=h.value&&(l.value=e,d())},S=async e=>{try{const s=e.statut===1?0:1;await $fetch(`${y.public.apiBase}/api/admin/business/${e.idBusiness}/status`,{method:"PUT",headers:{"Content-Type":"application/json",...k.getAuthHeaders()},body:{statut:s}}),_(`${e.denomination} a été ${s===1?"activé":"désactivé"}`),d()}catch(s){console.error("Error updating status:",s),w("Erreur lors de la mise à jour du statut")}},q=async e=>{if(confirm(`Supprimer "${e.denomination}" ?`))try{await $fetch(`${y.public.apiBase}/api/admin/business/${e.idBusiness}`,{method:"DELETE",headers:k.getAuthHeaders()}),_(`"${e.denomination}" a été supprimé`),d()}catch(s){console.error("Error deleting business:",s),w("Erreur lors de la suppression")}},T=e=>{const s="chip";return e===1?`${s} chip-green`:e===2?`${s} chip-yellow`:`${s} chip-gray`},D=e=>e===1?"Affichée":e===2?"En attente":"Bloquée";return j(()=>{d()}),H({title:"Admin - Business"}),(e,s)=>{const u=F("Icon"),p=z;return v(),f("div",Q,[t("aside",W,[t("div",X,[s[6]||(s[6]=t("h3",{class:"sidebar-title"},"Navigation",-1)),o(p,{to:"/admin",class:"sidebar-link"},{default:b(()=>[o(u,{name:"heroicons:home",class:"w-4 h-4"}),s[5]||(s[5]=m(" Dashboard ",-1))]),_:1,__:[5]})]),t("div",Y,[s[10]||(s[10]=t("h3",{class:"sidebar-title"},"Contenu",-1)),o(p,{to:"/admin/animes",class:"sidebar-link"},{default:b(()=>[o(u,{name:"heroicons:film",class:"w-4 h-4"}),s[7]||(s[7]=m(" Animes ",-1))]),_:1,__:[7]}),o(p,{to:"/admin/mangas",class:"sidebar-link"},{default:b(()=>[o(u,{name:"heroicons:book-open",class:"w-4 h-4"}),s[8]||(s[8]=m(" Mangas ",-1))]),_:1,__:[8]}),o(p,{to:"/admin/business",class:"sidebar-link active"},{default:b(()=>[o(u,{name:"heroicons:building-office",class:"w-4 h-4"}),s[9]||(s[9]=m(" Entreprises ",-1))]),_:1,__:[9]})]),t("div",Z,[s[16]||(s[16]=t("h3",{class:"sidebar-title"},"Liens Rapides",-1)),t("div",ss,[s[12]||(s[12]=t("a",{href:"/admin/business",class:"quick-link"},"/admin/business",-1)),s[13]||(s[13]=t("a",{href:"/admin/business/create",class:"quick-link"},"/admin/business/create",-1)),s[14]||(s[14]=t("a",{href:"/admin/animes",class:"quick-link"},"/admin/animes",-1)),s[15]||(s[15]=t("a",{href:"/admin/mangas",class:"quick-link"},"/admin/mangas",-1)),t("a",ts,[s[11]||(s[11]=m(" API Docs ",-1)),o(u,{name:"heroicons:arrow-top-right-on-square",class:"w-3 h-3 ml-1"})])])])]),t("main",es,[t("div",ns,[s[18]||(s[18]=t("h1",{class:"section-title"},"Admin · Business",-1)),o(p,{to:"/admin/business/create",class:"btn-primary"},{default:b(()=>s[17]||(s[17]=[m("Créer une entreprise",-1)])),_:1,__:[17]})]),t("div",as,[t("div",null,[s[19]||(s[19]=t("label",{class:"block text-sm mb-1"},"Recherche",-1)),C(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>a(i).search=n),class:"form-input",placeholder:"Dénomination...",onKeyup:L(d,["enter"])},null,544),[[E,a(i).search]])]),t("div",null,[s[20]||(s[20]=t("label",{class:"block text-sm mb-1"},"Type",-1)),C(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>a(i).type=n),class:"form-input"},null,512),[[E,a(i).type]])]),t("div",null,[s[22]||(s[22]=t("label",{class:"block text-sm mb-1"},"Statut",-1)),C(t("select",{"onUpdate:modelValue":s[2]||(s[2]=n=>a(i).statut=n),class:"form-input w-40"},s[21]||(s[21]=[t("option",{value:void 0},"Tous",-1),t("option",{value:1},"Affichée",-1),t("option",{value:2},"En attente",-1),t("option",{value:0},"Bloquée",-1)]),512),[[M,a(i).statut,void 0,{number:!0}]])]),t("button",{class:"btn-secondary",onClick:d},"Appliquer")]),a(x)?(v(),f("div",is,s[23]||(s[23]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1),t("p",{class:"mt-2 text-gray-600"},"Chargement...",-1)]))):a(g)?(v(),f("div",os,[t("p",null,r(a(g)),1),t("button",{class:"btn-secondary mt-2",onClick:d},"Réessayer")])):(v(),f("div",ls,[t("table",rs,[s[24]||(s[24]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Dénomination"),t("th",null,"Type"),t("th",null,"Origine"),t("th",null,"Statut"),t("th",null,"Actions")])],-1)),t("tbody",null,[(v(!0),f(R,null,U(a(B),n=>(v(),f("tr",{key:n.idBusiness},[t("td",null,r(n.idBusiness),1),t("td",null,[o(p,{to:`/admin/business/${n.idBusiness}`,class:"link"},{default:b(()=>[m(r(n.denomination),1)]),_:2},1032,["to"])]),t("td",null,r(n.type||"—"),1),t("td",null,r(n.origine||"—"),1),t("td",null,[t("span",{class:O(T(n.statut))},r(D(n.statut)),3)]),t("td",us,[t("button",{class:"btn-small",onClick:I=>S(n)},r(n.statut===1?"Désactiver":"Activer"),9,ds),t("button",{class:"btn-small danger",onClick:I=>q(n)}," Supprimer ",8,cs)])]))),128))])])])),t("div",ms,[t("div",ps,[t("button",{class:"btn-secondary",disabled:a(l)<=1,onClick:s[3]||(s[3]=n=>A(a(l)-1))}," Précédent ",8,fs),t("span",null,"Page "+r(a(l))+" / "+r(a(h)),1),t("button",{class:"btn-secondary",disabled:a(l)>=a(h),onClick:s[4]||(s[4]=n=>A(a(l)+1))}," Suivant ",8,bs)]),t("div",vs,r(a($))+" entreprises au total ",1)])])])}}}),_s=G(gs,[["__scopeId","data-v-8718a8b0"]]);export{_s as default};
