import{f as K,v as J,u as O,q as Q,g,H as W,h as X,G as Y,c as i,k as r,a as t,b as c,t as l,w as q,n as y,d as x,F as _,l as w,z as M,M as D,j as Z,e as ee,r as te,o,B as se,m as re,N as ae,p as oe,_ as ie}from"./Bes98wj2.js";import ne from"./BSmumdHB.js";import{u as le}from"./DzvRhcSF.js";import"./azFSasi8.js";const de={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},ce={key:0,class:"flex items-center justify-center py-12"},ue={key:1,class:"container mx-auto px-4 py-8"},ge={class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 text-center"},me={class:"text-red-600 dark:text-red-300"},xe={key:2,class:"container mx-auto px-4 py-8"},be={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden mb-8"},pe={class:"h-32 bg-gradient-to-r from-blue-500 to-purple-600 relative"},he={key:0,class:"absolute top-4 right-4"},ve={class:"px-6 py-6 relative"},fe={class:"absolute -top-16 left-6"},ye={class:"w-24 h-24 rounded-full border-4 border-white dark:border-gray-800 overflow-hidden bg-blue-500 flex items-center justify-center"},_e=["src","alt"],we={key:1,class:"text-white text-2xl font-bold"},ke={class:"ml-32"},$e={class:"flex items-center justify-between"},Ce={class:"text-2xl font-bold text-gray-900 dark:text-white mb-2"},Ae={class:"flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400"},qe={class:"flex items-center"},Me={key:0,class:"flex items-center"},De={key:0,class:"flex space-x-2"},Re={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},Se={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ie={class:"flex items-center justify-between"},je={class:"text-2xl font-bold text-gray-900 dark:text-white"},Le={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Be={class:"flex items-center justify-between"},Ve={class:"text-2xl font-bold text-gray-900 dark:text-white"},Ne={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Te={class:"flex items-center justify-between"},Ue={class:"text-2xl font-bold text-gray-900 dark:text-white"},Fe={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Pe={class:"flex items-center justify-between"},ze={class:"text-2xl font-bold text-gray-900 dark:text-white"},Ee={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden"},Ge={class:"border-b border-gray-200 dark:border-gray-700"},He={class:"flex space-x-8 px-6","aria-label":"Tabs"},Ke=["onClick"],Je={class:"p-6"},Oe={class:"space-y-6"},Qe={class:"flex items-center justify-between"},We={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Xe={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Ye={class:"space-y-6"},Ze={key:0,class:"space-y-4"},et={class:"flex-shrink-0"},tt={class:"flex-1"},st={class:"text-sm text-gray-900 dark:text-white"},rt={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},at={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},ot={class:"space-y-6"},it={key:0,class:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4"},nt={class:"space-y-2"},lt={class:"text-sm text-gray-600 dark:text-gray-400"},dt={class:"flex items-center space-x-2"},ct={class:"w-20 bg-gray-200 dark:bg-gray-600 rounded-full h-2"},ut={class:"text-sm text-gray-900 dark:text-white font-medium"},gt=K({__name:"[username]",setup(mt){const R=J(),u=R.params.username;O({title:`Profil de ${u} - Anime-Kun V2`,meta:[{name:"description",content:`Consultez le profil public de ${u} sur Anime-Kun`}]});const k=Q(),f=Z(),{getAvatarUrl:j}=le(),$=g(!0),b=g(""),p=g("reviews"),n=g(null),h=g(null),C=g([]),A=g([]),S=g(!1),I=W(()=>k.isAuthenticated&&k.user?.pseudo===u),L=[{id:"reviews",label:"Critiques"},{id:"activity",label:"Activité"},{id:"stats",label:"Statistiques"}],B=e=>e?new Date(typeof e=="string"?parseInt(e)*1e3:e*1e3).toLocaleDateString("fr-FR",{year:"numeric",month:"long"}):"Inconnu",V=e=>{if(!e)return"Inconnue";const s=new Date(typeof e=="string"?parseInt(e)*1e3:e*1e3),m=Math.abs(new Date().getTime()-s.getTime()),a=Math.ceil(m/(1e3*60*60*24));if(a===1)return"hier";if(a<7)return`il y a ${a} jours`;if(a<30){const v=Math.floor(a/7);return`il y a ${v} semaine${v>1?"s":""}`}else return s.toLocaleDateString("fr-FR")},N=e=>e?new Date(typeof e=="string"?parseInt(e)*1e3:e*1e3).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"}):"",T=()=>(n.value?.pseudo||n.value?.username||u).charAt(0).toUpperCase(),U=()=>{const e=n.value?.nbPost||0;return e>=1e3?"Expert":e>=500?"Avancé":e>=100?"Actif":e>=10?"Membre":"Débutant"},F=e=>{switch(e){case"review":return"heroicons:star";case"forum_post":return"heroicons:chat-bubble-left";case"anime_rated":return"heroicons:film";case"manga_rated":return"heroicons:book-open";default:return"heroicons:clock"}},P=e=>{switch(e.type){case"review":return`A écrit une critique pour "${e.title}"`;case"forum_post":return`A posté un message dans "${e.title}"`;case"anime_rated":return`A noté l'anime "${e.title}"`;case"manga_rated":return`A noté le manga "${e.title}"`;default:return e.description||"Activité"}},z=e=>({id:e.id||e.idCritique,idCritique:e.idCritique||e.id,niceUrl:e.niceUrl,titre:e.titre,critique:e.critique||e.contenu,notation:e.notation||e.note,dateCritique:e.reviewDate||e.dateCritique||e.dateCreation,statut:typeof e.statut=="number"?e.statut:1,idMembre:e.idMembre||e.userId||0,idAnime:e.idAnime||e.animeId||0,idManga:e.idManga||e.mangaId||0,nbClics:e.nbClics||e.nbVues||0,anime:e.anime,manga:e.manga,membre:e.membre||{id:n.value?.id,pseudo:n.value?.pseudo,avatar:n.value?.avatar}}),E=e=>{oe(`/review/${e.id||e.idCritique}`)},G=()=>{console.log("Send message to",u)},H=async()=>{try{$.value=!0,b.value="";const e=await $fetch(`${f.public.apiBase}/api/users/public/${u}`);n.value=e.user;const s=await $fetch(`${f.public.apiBase}/api/users/public/${u}/stats`);h.value=s;const d=await $fetch(`${f.public.apiBase}/api/users/public/${u}/reviews?limit=4`);C.value=d.reviews||[];const m=await $fetch(`${f.public.apiBase}/api/users/public/${u}/activity?limit=5`);A.value=m.activities||[]}catch(e){e.status===404?b.value=`L'utilisateur "${u}" n'existe pas.`:b.value=e.message||"Erreur lors du chargement du profil",console.error("Error loading public profile:",e)}finally{$.value=!1}};return X(()=>{H()}),Y(()=>R.params.username,e=>{e!==u&&window.location.reload()}),(e,s)=>{const d=te("Icon"),m=ee;return o(),i("div",de,[r($)?(o(),i("div",ce,s[1]||(s[1]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent"},null,-1),t("span",{class:"ml-3 text-gray-600 dark:text-gray-300"},"Chargement du profil...",-1)]))):r(b)?(o(),i("div",ue,[t("div",ge,[c(d,{name:"heroicons:exclamation-triangle",class:"w-12 h-12 text-red-500 mx-auto mb-4"}),s[3]||(s[3]=t("h2",{class:"text-xl font-semibold text-red-800 dark:text-red-200 mb-2"},"Utilisateur introuvable",-1)),t("p",me,l(r(b)),1),c(m,{to:"/",class:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},{default:q(()=>s[2]||(s[2]=[x(" Retour à l'accueil ",-1)])),_:1,__:[2]})])])):(o(),i("div",xe,[t("div",be,[t("div",pe,[r(I)?(o(),i("div",he,[c(m,{to:"/profile",class:"inline-flex items-center px-3 py-1 border border-white/20 rounded-md text-sm font-medium text-white hover:bg-white/10 transition-colors"},{default:q(()=>[c(d,{name:"heroicons:pencil-square",class:"w-4 h-4 mr-1"}),s[4]||(s[4]=x(" Modifier ",-1))]),_:1,__:[4]})])):y("",!0)]),t("div",ve,[t("div",fe,[t("div",ye,[r(n)?.avatar&&!r(S)?(o(),i("img",{key:0,src:r(j)(r(n).avatar),alt:r(n)?.pseudo||r(n)?.username,class:"w-full h-full object-cover",onError:s[0]||(s[0]=a=>S.value=!0)},null,40,_e)):(o(),i("span",we,l(T()),1))])]),t("div",ke,[t("div",$e,[t("div",null,[t("h1",Ce,l(r(n)?.pseudo||r(n)?.username),1),t("div",Ae,[t("div",qe,[c(d,{name:"heroicons:calendar",class:"w-4 h-4 mr-1"}),x(" Membre depuis "+l(B(r(n)?.dateInscription)),1)]),r(n)?.lastLogin?(o(),i("div",Me,[c(d,{name:"heroicons:clock",class:"w-4 h-4 mr-1"}),x(" Dernière connexion "+l(V(r(n).lastLogin)),1)])):y("",!0)])]),!r(I)&&r(k).isAuthenticated?(o(),i("div",De,[t("button",{onClick:G,class:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors"},[c(d,{name:"heroicons:envelope",class:"w-4 h-4 mr-1"}),s[5]||(s[5]=x(" Message ",-1))])])):y("",!0)])])])]),t("div",Re,[t("div",Se,[t("div",Ie,[t("div",null,[s[6]||(s[6]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Critiques",-1)),t("p",je,l(r(h)?.totalReviews||0),1)]),c(d,{name:"heroicons:star",class:"w-8 h-8 text-yellow-500"})])]),t("div",Le,[t("div",Be,[t("div",null,[s[7]||(s[7]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Messages forum",-1)),t("p",Ve,l(r(n)?.nbPost||0),1)]),c(d,{name:"heroicons:chat-bubble-left",class:"w-8 h-8 text-purple-500"})])]),t("div",Ne,[t("div",Te,[t("div",null,[s[8]||(s[8]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Réputation",-1)),t("p",Ue,l(r(n)?.reputation||0),1)]),c(d,{name:"heroicons:trophy",class:"w-8 h-8 text-amber-500"})])]),t("div",Fe,[t("div",Pe,[t("div",null,[s[9]||(s[9]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Niveau",-1)),t("p",ze,l(U()),1)]),c(d,{name:"heroicons:user-circle",class:"w-8 h-8 text-blue-500"})])])]),t("div",Ee,[t("div",Ge,[t("nav",He,[(o(),i(_,null,w(L,a=>t("button",{key:a.id,onClick:v=>p.value=a.id,class:se([r(p)===a.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},l(a.label),11,Ke)),64))])]),t("div",Je,[M(t("div",Oe,[t("div",Qe,[s[11]||(s[11]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Critiques récentes",-1)),c(m,{to:`/user/${r(u)}/reviews`,class:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"},{default:q(()=>s[10]||(s[10]=[x(" Voir toutes → ",-1)])),_:1,__:[10]},8,["to"])]),r(C).length?(o(),i("div",We,[(o(!0),i(_,null,w(r(C),a=>(o(),re(ne,{key:a.id||a.idCritique,review:z(a),onView:E},null,8,["review"]))),128))])):(o(),i("div",Xe," Aucune critique publiée "))],512),[[D,r(p)==="reviews"]]),M(t("div",Ye,[s[12]||(s[12]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Activité récente",-1)),r(A).length?(o(),i("div",Ze,[(o(!0),i(_,null,w(r(A),a=>(o(),i("div",{key:a.id,class:"flex items-start space-x-4 p-4 border border-gray-200 dark:border-gray-700 rounded-lg"},[t("div",et,[c(d,{name:F(a.type),class:"w-6 h-6 text-gray-500"},null,8,["name"])]),t("div",tt,[t("p",st,l(P(a)),1),t("p",rt,l(N(a.date)),1)])]))),128))])):(o(),i("div",at," Aucune activité récente publique "))],512),[[D,r(p)==="activity"]]),M(t("div",ot,[s[14]||(s[14]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Statistiques publiques",-1)),r(h)?.reviewStats?(o(),i("div",it,[s[13]||(s[13]=t("h4",{class:"font-medium text-gray-900 dark:text-white mb-3"},"Distribution des notes de critiques",-1)),t("div",nt,[(o(!0),i(_,null,w(r(h).reviewStats,a=>(o(),i("div",{key:a.rating,class:"flex items-center justify-between"},[t("span",lt,l(a.rating)+"/10",1),t("div",dt,[t("div",ct,[t("div",{class:"bg-yellow-500 h-2 rounded-full",style:ae({width:`${a.count/Math.max(...r(h).reviewStats.map(v=>v.count))*100}%`})},null,4)]),t("span",ut,l(a.count),1)])]))),128))])])):y("",!0),s[15]||(s[15]=t("div",{class:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4"},[t("h4",{class:"font-medium text-gray-900 dark:text-white mb-3"},"Activité mensuelle"),t("div",{class:"text-center py-4 text-gray-500 dark:text-gray-400"}," Graphique d'activité bientôt disponible ")],-1))],512),[[D,r(p)==="stats"]])])])]))])}}}),vt=ie(gt,[["__scopeId","data-v-13811594"]]);export{vt as default};
