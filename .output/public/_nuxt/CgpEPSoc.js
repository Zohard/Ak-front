import{f as D,u as N,g as u,h as j,i as z,j as k,c as n,a as s,b as c,d as f,w as A,k as d,F as C,l as q,t as m,e as F,r as O,o,m as P,n as y,p as H,_ as T}from"./Bes98wj2.js";import K from"./BSmumdHB.js";import G from"./Bq8Z0Zay.js";import J from"./BEodny5e.js";import{u as Q}from"./BUUJWTKH.js";import{u as W}from"./DzvRhcSF.js";import{u as X}from"./DMFesj3P.js";import"./azFSasi8.js";import"./x_rD_Ya3.js";const Y={class:"main-content"},Z={class:"hero-layout"},ee={class:"hero-carousel-section"},te={class:"forum-panel-section"},se={class:"section"},ae={class:"section-header"},ie={class:"section-title flex items-center gap-3"},oe={key:0,class:"loading"},ne={key:1,class:"articles-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"},re={key:2,class:"bg-gray-100 dark:bg-gray-700 p-8 rounded-lg text-center"},le={class:"section"},ce={class:"section-header"},de={class:"section-title flex items-center gap-3"},ue={key:0,class:"loading"},me={key:1,class:"articles-grid"},ge=["onClick"],pe={class:"aspect-w-3 aspect-h-4 mb-4 bg-gray-200 dark:bg-gray-700 rounded overflow-hidden"},ve=["src","alt"],fe={key:1,class:"flex items-center justify-center"},_e={class:"font-semibold text-lg mb-2 line-clamp-2"},he={class:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2"},ye={key:0},be={key:1},we={key:0,class:"text-sm text-gray-600 dark:text-gray-300 line-clamp-3"},xe={key:2,class:"bg-gray-100 dark:bg-gray-700 p-8 rounded-lg text-center"},ke={class:"section"},Ae={class:"section-header"},Ce={class:"section-title flex items-center gap-3"},qe={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Ie={class:"card text-center"},Re={class:"text-2xl font-bold text-blue-600"},Ue={class:"card text-center"},Me={class:"text-2xl font-bold text-green-600"},Be={class:"card text-center"},Ee={class:"text-2xl font-bold text-purple-600"},Se=D({__name:"index",setup(Ve){N({title:"Accueil - Anime-Kun",meta:[{name:"description",content:"Découvrez notre collection d'animes et mangas avec critiques et notes de la communauté"}]});const{fetchAnimes:b}=Q(),{getImageUrl:I}=W(),{fetchReviews:R}=X(),g=u({animes:0,mangas:0,reviews:0}),_=u([]),w=u(!0),p=u([]),x=u(!0),a=u(!1),h=u(!1);let l=null;j(async()=>{if(console.log("Index page mounted"),!h.value){a.value=!0,h.value=!0,l=new AbortController;try{if(await U(),console.log("Stats loaded successfully"),!a.value||(await M(),console.log("Reviews loaded successfully"),!a.value))return;await B(),console.log("Animes loaded successfully")}catch(e){console.error("Error loading homepage data:",e)}finally{h.value=!1}console.log("Index page mount complete")}}),z(()=>{a.value=!1,l&&(l.abort(),l=null)});const U=async()=>{if(!(!a.value||!l))try{const e=l.signal;if(e.aborted||!a.value)return;const[t,r,v]=await Promise.allSettled([b({limit:1}).catch(()=>({pagination:{total:0}})),$fetch(`${k().public.apiBase}/api/mangas`,{params:{limit:1},signal:e}).catch(()=>({pagination:{total:0}})),$fetch(`${k().public.apiBase}/api/reviews/count`,{signal:e}).catch(()=>({count:0}))]);if(!a.value||e.aborted)return;g.value={animes:t.status==="fulfilled"&&t.value?.pagination?.total||0,mangas:r.status==="fulfilled"&&r.value?.pagination?.total||0,reviews:v.status==="fulfilled"&&v.value?.count||0}}catch(e){if(e?.name==="AbortError"||!a.value)return;console.error("Error loading stats:",e),a.value&&(g.value={animes:0,mangas:0,reviews:0})}},M=async()=>{if(!(!a.value||!l))try{const e=l.signal;if(e.aborted||!a.value)return;const t=await R({limit:4,sortBy:"dateCritique",sortOrder:"desc"}).catch(()=>({data:[],reviews:[]}));if(!a.value||e.aborted)return;const r=t.data||t.reviews||[];_.value=Array.isArray(r)?r.map($):[]}catch(e){if(e?.name==="AbortError"||!a.value)return;console.error("Error loading critiques:",e),a.value&&(_.value=[])}finally{a.value&&(w.value=!1)}},B=async()=>{if(!(!a.value||!l))try{const e=l.signal;if(e.aborted||!a.value)return;const t=await b({limit:3,sortBy:"titre",sortOrder:"asc"}).catch(()=>({animes:[]}));if(!a.value||e.aborted)return;t&&Array.isArray(t.animes)?p.value=t.animes:p.value=[]}catch(e){if(e?.name==="AbortError"||!a.value)return;console.error("Error loading featured animes:",e),a.value&&(p.value=[])}finally{a.value&&(x.value=!1)}},E=e=>`/anime/${e.niceUrl||S(e.titre)}-${e.id}`,S=e=>e.toLowerCase().replace(/[àáâãäå]/g,"a").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/[ýÿ]/g,"y").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),V=e=>{console.log("viewAnime called in index page with:",e),H(E(e))},L=e=>{},$=e=>!e||typeof e!="object"?{idCritique:0,niceUrl:"",titre:"Untitled Review",critique:"",notation:0,dateCritique:new Date().toISOString(),statut:1,idMembre:0,idAnime:0,idManga:0,nbClics:0,anime:null,manga:null,membre:void 0}:{idCritique:e.idCritique||e.id||0,niceUrl:e.niceUrl||"",titre:e.titre||"Untitled Review",critique:e.critique||e.contenu||"",notation:e.notation||e.note||0,dateCritique:e.reviewDate||e.dateCritique||e.dateCreation||new Date().toISOString(),statut:typeof e.statut=="number"?e.statut:1,idMembre:e.idMembre||e.userId||0,idAnime:e.idAnime||e.animeId||0,idManga:e.idManga||e.mangaId||0,nbClics:e.nbClics||e.nbVues||0,anime:e.anime||null,manga:e.manga||null,membre:e.membre?{id:e.membre.id||e.membre.idMember||0,pseudo:e.membre.pseudo||e.membre.memberName||"Anonymous",avatar:e.membre.avatar||""}:void 0};return(e,t)=>{const r=O("Icon"),v=F;return o(),n("div",Y,[s("div",Z,[s("div",ee,[c(G)]),s("div",te,[c(J)])]),s("section",se,[s("div",ae,[s("h2",ie,[c(r,{name:"heroicons:star",class:"w-6 h-6 text-yellow-500"}),t[0]||(t[0]=f(" Dernières critiques ",-1))]),c(v,{to:"/reviews",class:"section-link flex items-center gap-2"},{default:A(()=>[t[1]||(t[1]=f(" Voir toutes les critiques ",-1)),c(r,{name:"heroicons:arrow-right",class:"w-4 h-4"})]),_:1,__:[1]})]),d(w)?(o(),n("div",oe," Chargement des critiques... ")):d(_).length>0?(o(),n("div",ne,[(o(!0),n(C,null,q(d(_),i=>(o(),P(K,{key:i.idCritique||i.id,review:i,onView:L},null,8,["review"]))),128))])):(o(),n("div",re,t[2]||(t[2]=[s("p",null,"Aucune critique disponible",-1)])))]),s("section",le,[s("div",ce,[s("h2",de,[c(r,{name:"heroicons:film",class:"w-6 h-6 text-blue-500"}),t[3]||(t[3]=f(" Les animés du moment ",-1))]),c(v,{to:"/animes",class:"section-link flex items-center gap-2"},{default:A(()=>[t[4]||(t[4]=f(" Voir tous les animés ",-1)),c(r,{name:"heroicons:arrow-right",class:"w-4 h-4"})]),_:1,__:[4]})]),d(x)?(o(),n("div",ue," Chargement des animés... ")):d(p).length>0?(o(),n("div",me,[(o(!0),n(C,null,q(d(p),i=>(o(),n("div",{key:i.id,class:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>V(i)},[s("div",pe,[i.image?(o(),n("img",{key:0,src:d(I)(i.image,"anime"),alt:i.titre,class:"w-full h-full object-cover",loading:"lazy"},null,8,ve)):(o(),n("div",fe,[c(r,{name:"heroicons:film",class:"w-12 h-12 text-gray-400"})]))]),s("h3",_e,m(i.titre),1),s("div",he,[i.annee?(o(),n("span",ye,m(i.annee),1)):y("",!0),i.nbEp?(o(),n("span",be,"• "+m(i.nbEp)+" ép.",1)):y("",!0)]),i.synopsis?(o(),n("p",we,m(i.synopsis),1)):y("",!0)],8,ge))),128))])):(o(),n("div",xe,t[5]||(t[5]=[s("p",null,"Aucun animé disponible",-1)])))]),s("section",ke,[s("div",Ae,[s("h2",Ce,[c(r,{name:"heroicons:chart-bar",class:"w-6 h-6 text-green-500"}),t[6]||(t[6]=f(" Statistiques ",-1))])]),s("div",qe,[s("div",Ie,[s("h3",Re,m(d(g).animes||"..."),1),t[7]||(t[7]=s("p",{class:"text-gray-600 dark:text-gray-300"},"Animes",-1))]),s("div",Ue,[s("h3",Me,m(d(g).mangas||"..."),1),t[8]||(t[8]=s("p",{class:"text-gray-600 dark:text-gray-300"},"Mangas",-1))]),s("div",Be,[s("h3",Ee,m(d(g).reviews||"..."),1),t[9]||(t[9]=s("p",{class:"text-gray-600 dark:text-gray-300"},"Critiques",-1))])])])])}}}),He=T(Se,[["__scopeId","data-v-c358f8ee"]]);export{He as default};
