import{f as V,q as D,g as p,x as I,h as N,u as R,c as b,a as s,b as o,w as f,d as c,z as k,A as C,k as i,ac as U,K as j,t as l,F as H,l as L,j as K,e as z,r as F,o as v,B as G,_ as J}from"./CCeOfYC8.js";import{u as O}from"./B7NL00rM.js";const Q={class:"admin-layout"},W={class:"admin-sidebar"},X={class:"sidebar-section"},Y={class:"sidebar-section"},Z={class:"sidebar-section"},tt={class:"quick-links"},st={href:"http://localhost:3003/docs",target:"_blank",class:"quick-link"},et={class:"admin-main"},nt={class:"section-header"},at={class:"card p-4 mb-4 flex gap-3 items-end"},it={key:0,class:"card p-4 text-center"},lt={key:1,class:"card p-4 text-center text-red-600"},ot={key:2,class:"card overflow-x-auto"},rt={class:"table"},ut={class:"flex gap-2"},dt=["onClick"],ct=["onClick"],mt={class:"mt-4 flex items-center justify-between"},pt={class:"flex items-center gap-3"},bt=["disabled"],ft=["disabled"],vt={class:"text-sm text-gray-600"},gt=V({__name:"index",setup(ht){const y=K(),x=D(),{success:_,error:A}=O(),E=p([]),$=p(!1),g=p(null),r=p(1),h=p(1),w=p(0),a=I({search:"",annee:"",editeur:"",statut:void 0}),d=async()=>{try{$.value=!0,g.value=null;const e={page:r.value,limit:20};a.search?.trim()&&(e.search=a.search.trim()),a.annee?.trim()&&(e.annee=a.annee.trim()),a.editeur?.trim()&&(e.editeur=a.editeur.trim()),typeof a.statut=="number"&&(e.statut=a.statut);const t=await $fetch(`${y.public.apiBase}/api/admin/mangas`,{params:e,headers:x.getAuthHeaders()});E.value=t.items||[];const u=t.pagination||{};r.value=u.page||1,h.value=u.totalPages||1,w.value=u.total||0,r.value===1&&!a.search&&!a.annee&&!a.editeur&&typeof a.statut!="number"&&_(`${w.value} mangas chargés avec succès`,{duration:3e3})}catch(e){g.value=e?.data?.message||"Erreur lors du chargement des mangas",console.error("Error loading mangas:",e)}finally{$.value=!1}},M=e=>{e>=1&&e<=h.value&&(r.value=e,d())},S=async e=>{try{const t=e.statut===1?0:1;await $fetch(`${y.public.apiBase}/api/admin/mangas/${e.idManga}/status`,{method:"PUT",headers:{"Content-Type":"application/json",...x.getAuthHeaders()},body:{statut:t}}),_(`${e.titre} a été ${t===1?"publié":"dépublié"}`),d()}catch(t){console.error("Error updating status:",t),A("Erreur lors de la mise à jour du statut")}},q=async e=>{if(confirm(`Supprimer "${e.titre}" ?`))try{await $fetch(`${y.public.apiBase}/api/admin/mangas/${e.idManga}`,{method:"DELETE",headers:x.getAuthHeaders()}),_(`"${e.titre}" a été supprimé`),d()}catch(t){console.error("Error deleting manga:",t),A("Erreur lors de la suppression")}},P=e=>{const t="chip";return e===1?`${t} chip-green`:e===2?`${t} chip-red`:`${t} chip-gray`},T=e=>e===1?"Publié":e===2?"Refusé":"Brouillon";return N(()=>{d()}),R({title:"Admin - Mangas"}),(e,t)=>{const u=F("Icon"),m=z;return v(),b("div",Q,[s("aside",W,[s("div",X,[t[7]||(t[7]=s("h3",{class:"sidebar-title"},"Navigation",-1)),o(m,{to:"/admin",class:"sidebar-link"},{default:f(()=>[o(u,{name:"heroicons:home",class:"w-4 h-4"}),t[6]||(t[6]=c(" Dashboard ",-1))]),_:1,__:[6]})]),s("div",Y,[t[11]||(t[11]=s("h3",{class:"sidebar-title"},"Contenu",-1)),o(m,{to:"/admin/animes",class:"sidebar-link"},{default:f(()=>[o(u,{name:"heroicons:film",class:"w-4 h-4"}),t[8]||(t[8]=c(" Animes ",-1))]),_:1,__:[8]}),o(m,{to:"/admin/mangas",class:"sidebar-link active"},{default:f(()=>[o(u,{name:"heroicons:book-open",class:"w-4 h-4"}),t[9]||(t[9]=c(" Mangas ",-1))]),_:1,__:[9]}),o(m,{to:"/admin/business",class:"sidebar-link"},{default:f(()=>[o(u,{name:"heroicons:building-office",class:"w-4 h-4"}),t[10]||(t[10]=c(" Entreprises ",-1))]),_:1,__:[10]})]),s("div",Z,[t[17]||(t[17]=s("h3",{class:"sidebar-title"},"Liens Rapides",-1)),s("div",tt,[t[13]||(t[13]=s("a",{href:"/admin/mangas",class:"quick-link"},"/admin/mangas",-1)),t[14]||(t[14]=s("a",{href:"/admin/mangas/create",class:"quick-link"},"/admin/mangas/create",-1)),t[15]||(t[15]=s("a",{href:"/admin/animes",class:"quick-link"},"/admin/animes",-1)),t[16]||(t[16]=s("a",{href:"/admin/business",class:"quick-link"},"/admin/business",-1)),s("a",st,[t[12]||(t[12]=c(" API Docs ",-1)),o(u,{name:"heroicons:arrow-top-right-on-square",class:"w-3 h-3 ml-1"})])])])]),s("main",et,[s("div",nt,[t[19]||(t[19]=s("h1",{class:"section-title"},"Admin · Mangas",-1)),o(m,{to:"/admin/mangas/create",class:"btn-primary"},{default:f(()=>t[18]||(t[18]=[c("Créer un manga",-1)])),_:1,__:[18]})]),s("div",at,[s("div",null,[t[20]||(t[20]=s("label",{class:"block text-sm mb-1"},"Recherche",-1)),k(s("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>i(a).search=n),class:"form-input",placeholder:"Titre...",onKeyup:U(d,["enter"])},null,544),[[C,i(a).search]])]),s("div",null,[t[21]||(t[21]=s("label",{class:"block text-sm mb-1"},"Année",-1)),k(s("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>i(a).annee=n),class:"form-input w-32",placeholder:"2024"},null,512),[[C,i(a).annee]])]),s("div",null,[t[22]||(t[22]=s("label",{class:"block text-sm mb-1"},"Éditeur",-1)),k(s("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>i(a).editeur=n),class:"form-input",placeholder:"Éditeur..."},null,512),[[C,i(a).editeur]])]),s("div",null,[t[24]||(t[24]=s("label",{class:"block text-sm mb-1"},"Statut",-1)),k(s("select",{"onUpdate:modelValue":t[3]||(t[3]=n=>i(a).statut=n),class:"form-input w-40"},t[23]||(t[23]=[s("option",{value:void 0},"Tous",-1),s("option",{value:1},"Affichée",-1),s("option",{value:2},"En attente",-1),s("option",{value:0},"Bloquée",-1)]),512),[[j,i(a).statut,void 0,{number:!0}]])]),s("button",{class:"btn-secondary",onClick:d},"Appliquer")]),i($)?(v(),b("div",it,t[25]||(t[25]=[s("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1),s("p",{class:"mt-2 text-gray-600"},"Chargement...",-1)]))):i(g)?(v(),b("div",lt,[s("p",null,l(i(g)),1),s("button",{class:"btn-secondary mt-2",onClick:d},"Réessayer")])):(v(),b("div",ot,[s("table",rt,[t[26]||(t[26]=s("thead",null,[s("tr",null,[s("th",null,"ID"),s("th",null,"Titre"),s("th",null,"Auteur"),s("th",null,"Année"),s("th",null,"Volumes"),s("th",null,"Éditeur"),s("th",null,"Statut"),s("th",null,"Actions")])],-1)),s("tbody",null,[(v(!0),b(H,null,L(i(E),n=>(v(),b("tr",{key:n.idManga},[s("td",null,l(n.idManga),1),s("td",null,[o(m,{to:`/admin/mangas/${n.idManga}`,class:"link"},{default:f(()=>[c(l(n.titre),1)]),_:2},1032,["to"])]),s("td",null,l(n.auteur||"—"),1),s("td",null,l(n.annee||"—"),1),s("td",null,l(n.nbVolumes||"—"),1),s("td",null,l(n.editeur||"—"),1),s("td",null,[s("span",{class:G(P(n.statut))},l(T(n.statut)),3)]),s("td",ut,[s("button",{class:"btn-small",onClick:B=>S(n)},l(n.statut===1?"Dépublier":"Publier"),9,dt),s("button",{class:"btn-small danger",onClick:B=>q(n)}," Supprimer ",8,ct)])]))),128))])])])),s("div",mt,[s("div",pt,[s("button",{class:"btn-secondary",disabled:i(r)<=1,onClick:t[4]||(t[4]=n=>M(i(r)-1))}," Précédent ",8,bt),s("span",null,"Page "+l(i(r))+" / "+l(i(h)),1),s("button",{class:"btn-secondary",disabled:i(r)>=i(h),onClick:t[5]||(t[5]=n=>M(i(r)+1))}," Suivant ",8,ft)]),s("div",vt,l(i(w))+" mangas au total ",1)])])])}}}),xt=J(gt,[["__scopeId","data-v-25e739fd"]]);export{xt as default};
