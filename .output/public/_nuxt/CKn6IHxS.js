import{f as H,q as J,I as O,g as v,x as W,H as S,U as Q,G as X,c as l,a as e,t as u,k as s,N as Y,y as Z,n as g,z as m,W as _,b,A as h,J as U,F as A,l as M,d as w,D as ee,m as R,r as z,p as j,o,B as te,_ as se}from"./CCeOfYC8.js";import{u as re}from"./B9jFdIe5.js";import{u as ae}from"./C_YtV1it.js";const oe={class:"review-create-page"},le={class:"container mx-auto px-6 py-8"},ie={class:"max-w-4xl mx-auto"},ne={class:"mb-8"},de={class:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400 mb-2"},ue={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"},ce={key:0,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border border-gray-200 dark:border-gray-700"},ge={class:"mb-6"},me={class:"flex space-x-4"},be={class:"flex items-center"},pe={class:"flex items-center"},ye={class:"mb-6"},xe={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},ve={class:"relative"},fe={key:0,class:"mb-6"},ke={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto"},he=["onClick"],we={class:"flex space-x-3"},_e={class:"flex-shrink-0"},Te=["src","alt"],Ce={key:1,class:"w-16 h-20 bg-gray-200 dark:bg-gray-600 rounded flex items-center justify-center"},Pe={class:"flex-1 min-w-0"},Ve={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},qe={class:"text-sm text-gray-600 dark:text-gray-400"},Ie={key:1,class:"mb-6"},Se={class:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"},Ue={class:"flex space-x-4"},Ae=["src","alt"],Me={class:"text-lg font-semibold text-gray-900 dark:text-white"},Re={class:"text-gray-600 dark:text-gray-400"},ze={key:1,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border border-gray-200 dark:border-gray-700"},je={class:"mb-6"},Ne={class:"mb-6"},$e={class:"flex items-center space-x-4"},Be={class:"mb-6"},De={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},Ee={key:0,class:"text-yellow-600"},Fe={class:"mb-6"},Ke={key:0,class:"mt-2 flex flex-wrap gap-2"},Le=["onClick"],Ge={key:2,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border border-gray-200 dark:border-gray-700"},He={class:"mb-6"},Je={class:"space-y-2"},Oe={class:"flex items-center"},We={class:"flex items-center"},Qe={class:"mb-6"},Xe={class:"flex items-center"},Ye={class:"mb-6"},Ze={class:"border border-gray-200 dark:border-gray-600 rounded-lg p-4 bg-gray-50 dark:bg-gray-900"},et={class:"flex items-start space-x-4 mb-4"},tt=["src","alt"],st={class:"text-lg font-semibold text-gray-900 dark:text-white"},rt={class:"text-gray-600 dark:text-gray-400"},at={class:"text-sm text-gray-600 dark:text-gray-400 line-clamp-3"},ot={class:"flex items-center justify-between pt-6"},lt={key:1},it={class:"flex space-x-3"},nt=["disabled"],dt=["disabled"],ut=H({__name:"create",async setup(ct){let C,P;J().isAuthenticated||([C,P]=O(()=>j("/login?redirect="+encodeURIComponent("/reviews/create"))),await C,P());const{getImageUrl:T}=re(),N=ae(),n=v(1),f=v(!1),p=v(""),y=v([]),d=v(null),k=v(""),r=W({mediaType:"anime",mediaId:null,title:"",content:"",rating:7,tags:[],isPublic:!0,allowComments:!0}),V=S(()=>n.value===1?d.value!==null:n.value===2?r.title.trim()&&r.content.trim()&&r.rating>=0&&r.rating<=10:!0),q=S(()=>d.value&&r.title.trim()&&r.content.trim()&&r.rating>=0&&r.rating<=10),I=L(async()=>{if(!p.value.trim()){y.value=[];return}try{const i=await $fetch(`/api/${r.mediaType}s`,{params:{search:p.value.trim(),limit:12}});y.value=i.data||[]}catch(i){console.error("Search error:",i),y.value=[]}},300),$=i=>{d.value=i,r.mediaId=i.id},B=()=>{const i=k.value.split(",").map(t=>t.trim().toLowerCase()).filter(t=>t.length>0);r.tags=[...new Set(i)]},D=i=>{const t=r.tags.indexOf(i);t>-1&&(r.tags.splice(t,1),k.value=r.tags.join(", "))},E=()=>{V.value&&n.value<3&&n.value++},F=()=>{n.value>1&&n.value--},K=async()=>{if(q.value){f.value=!0;try{const i={title:r.title.trim(),content:r.content.trim(),rating:r.rating,tags:r.tags,isPublic:r.isPublic,allowComments:r.allowComments,[r.mediaType==="anime"?"idAnime":"idManga"]:r.mediaId},t=await N.createReview(i),c=t?.slug||t?.niceUrl,x=t?.id||t?.idCritique||t?.data?.id,a=c||x;a&&await j(`/review/${a}`)}catch(i){console.error("Error creating review:",i),alert("Erreur lors de la création de la critique")}finally{f.value=!1}}};function L(i,t){let c=null;return((...x)=>{c&&clearTimeout(c),c=setTimeout(()=>i.apply(null,x),t)})}return Q({title:"Écrire une critique - AK9",description:"Partagez votre opinion sur vos animes et mangas favoris avec la communauté AK9",ogTitle:"Écrire une critique - AK9",ogDescription:"Partagez votre opinion sur vos animes et mangas favoris avec la communauté AK9",robots:"noindex, nofollow"}),X(()=>r.mediaType,()=>{y.value=[],d.value=null,r.mediaId=null,p.value=""}),(i,t)=>{const c=z("Icon"),x=z("ReviewRating");return o(),l("div",oe,[t[32]||(t[32]=e("div",{class:"bg-gradient-to-r from-blue-600 to-purple-600 text-white"},[e("div",{class:"container mx-auto px-6 py-12"},[e("h1",{class:"text-4xl font-bold mb-2"},"Écrire une critique"),e("p",{class:"text-blue-100 text-lg"},"Partagez votre opinion sur votre anime ou manga favori")])],-1)),e("div",le,[e("div",ie,[e("div",ne,[e("div",de,[e("span",null,"Étape "+u(s(n))+" sur 3",1),e("span",null,u(Math.round(s(n)/3*100))+"% complété",1)]),e("div",ue,[e("div",{class:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:Y({width:`${s(n)/3*100}%`})},null,4)])]),e("form",{onSubmit:Z(K,["prevent"]),class:"space-y-8"},[s(n)===1?(o(),l("div",ce,[t[16]||(t[16]=e("h2",{class:"text-2xl font-semibold text-gray-900 dark:text-white mb-6"},"1. Choisissez le média",-1)),e("div",ge,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"Type de média",-1)),e("div",me,[e("label",be,[m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>s(r).mediaType=a),type:"radio",value:"anime",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[_,s(r).mediaType]]),t[11]||(t[11]=e("span",{class:"ml-2"},"Anime",-1))]),e("label",pe,[m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>s(r).mediaType=a),type:"radio",value:"manga",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[_,s(r).mediaType]]),t[12]||(t[12]=e("span",{class:"ml-2"},"Manga",-1))])])]),e("div",ye,[e("label",xe," Rechercher "+u(s(r).mediaType==="anime"?"un anime":"un manga"),1),e("div",ve,[m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>U(p)?p.value=a:null),type:"text",placeholder:"Tapez pour rechercher...",class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",onInput:t[3]||(t[3]=(...a)=>s(I)&&s(I)(...a))},null,544),[[h,s(p)]]),b(c,{name:"heroicons:magnifying-glass",class:"absolute right-3 top-3.5 w-5 h-5 text-gray-400"})])]),s(y).length>0?(o(),l("div",fe,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Résultats de recherche",-1)),e("div",ke,[(o(!0),l(A,null,M(s(y),a=>(o(),l("div",{key:a.id,onClick:G=>$(a),class:te(["p-4 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md",s(d)?.id===a.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300"])},[e("div",we,[e("div",_e,[a.image?(o(),l("img",{key:0,src:s(T)(a.image,s(r).mediaType),alt:a.titre,class:"w-16 h-20 object-cover rounded"},null,8,Te)):(o(),l("div",Ce,[b(c,{name:s(r).mediaType==="anime"?"heroicons:film":"heroicons:book-open",class:"w-6 h-6 text-gray-400"},null,8,["name"])]))]),e("div",Pe,[e("h4",Ve,u(a.titre),1),e("p",qe,u(a.annee||"Année inconnue"),1)])])],10,he))),128))])])):g("",!0),s(d)?(o(),l("div",Ie,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Média sélectionné",-1)),e("div",Se,[e("div",Ue,[s(d).image?(o(),l("img",{key:0,src:s(T)(s(d).image,s(r).mediaType),alt:s(d).titre,class:"w-20 h-28 object-cover rounded"},null,8,Ae)):g("",!0),e("div",null,[e("h4",Me,u(s(d).titre),1),e("p",Re,u(s(d).annee||"Année inconnue"),1)])])])])):g("",!0)])):g("",!0),s(n)===2?(o(),l("div",ze,[t[23]||(t[23]=e("h2",{class:"text-2xl font-semibold text-gray-900 dark:text-white mb-6"},"2. Votre critique",-1)),e("div",je,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Titre de votre critique *",-1)),m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>s(r).title=a),type:"text",required:"",placeholder:"Ex: Une masterpiece du genre shonen",class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},null,512),[[h,s(r).title]])]),e("div",Ne,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Note sur 10 *",-1)),e("div",$e,[m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>s(r).rating=a),type:"number",min:"0",max:"10",step:"0.1",required:"",class:"w-24 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"},null,512),[[h,s(r).rating,void 0,{number:!0}]]),t[18]||(t[18]=e("span",{class:"text-gray-600 dark:text-gray-400"},"/ 10",-1)),b(x,{rating:s(r).rating,"max-rating":10,mode:"display",size:"lg"},null,8,["rating"])])]),e("div",Be,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Contenu de votre critique *",-1)),t[21]||(t[21]=e("div",{class:"mb-2"},[e("div",{class:"flex flex-wrap gap-2 text-xs text-gray-600 dark:text-gray-400"},[e("span",null,"Formatage disponible:"),e("code",null,"[b]gras[/b]"),e("code",null,"[i]italique[/i]"),e("code",null,"[quote]citation[/quote]"),e("code",null,"[spoiler]spoiler[/spoiler]")])],-1)),m(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=a=>s(r).content=a),required:"",rows:"15",placeholder:"Partagez votre analyse détaillée du média...",class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white resize-y"},null,512),[[h,s(r).content]]),e("div",De,[w(u(s(r).content.length)+" caractères ",1),s(r).content.length<500?(o(),l("span",Ee,"(minimum recommandé: 500)")):g("",!0)])]),e("div",Fe,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Tags (optionnel)",-1)),m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>U(k)?k.value=a:null),type:"text",placeholder:"Ex: action, aventure, shonen (séparés par des virgules)",class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",onInput:B},null,544),[[h,s(k)]]),s(r).tags.length>0?(o(),l("div",Ke,[(o(!0),l(A,null,M(s(r).tags,a=>(o(),l("span",{key:a,class:"inline-flex items-center px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full"},[w(u(a)+" ",1),e("button",{onClick:G=>D(a),class:"ml-2 text-blue-600 hover:text-blue-800"},[b(c,{name:"heroicons:x-mark",class:"w-3 h-3"})],8,Le)]))),128))])):g("",!0)])])):g("",!0),s(n)===3?(o(),l("div",Ge,[t[29]||(t[29]=e("h2",{class:"text-2xl font-semibold text-gray-900 dark:text-white mb-6"},"3. Paramètres de publication",-1)),e("div",He,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Visibilité",-1)),e("div",Je,[e("label",Oe,[m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>s(r).isPublic=a),type:"radio",value:!0,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[_,s(r).isPublic]]),t[24]||(t[24]=e("span",{class:"ml-2"},"Publique - Visible par tous les utilisateurs",-1))]),e("label",We,[m(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>s(r).isPublic=a),type:"radio",value:!1,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[_,s(r).isPublic]]),t[25]||(t[25]=e("span",{class:"ml-2"},"Privée - Visible uniquement par vous",-1))])])]),e("div",Qe,[e("label",Xe,[m(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>s(r).allowComments=a),type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[ee,s(r).allowComments]]),t[27]||(t[27]=e("span",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},"Autoriser les commentaires",-1))])]),e("div",Ye,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"Prévisualisation",-1)),e("div",Ze,[e("div",et,[s(d)?.image?(o(),l("img",{key:0,src:s(T)(s(d).image,s(r).mediaType),alt:s(d).titre,class:"w-16 h-20 object-cover rounded"},null,8,tt)):g("",!0),e("div",null,[e("h3",st,u(s(r).title),1),e("p",rt,u(s(d)?.titre),1),b(x,{rating:s(r).rating,"max-rating":10,mode:"display"},null,8,["rating"])])]),e("div",at,u(s(r).content.substring(0,200))+u(s(r).content.length>200?"...":""),1)])])])):g("",!0),e("div",ot,[s(n)>1?(o(),l("button",{key:0,onClick:F,type:"button",class:"px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"},[b(c,{name:"heroicons:arrow-left",class:"w-4 h-4 inline mr-2"}),t[30]||(t[30]=w(" Précédent ",-1))])):(o(),l("div",lt)),e("div",it,[s(n)<3?(o(),l("button",{key:0,onClick:E,type:"button",disabled:!s(V),class:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[t[31]||(t[31]=w(" Suivant ",-1)),b(c,{name:"heroicons:arrow-right",class:"w-4 h-4 inline ml-2"})],8,nt)):g("",!0),s(n)===3?(o(),l("button",{key:1,type:"submit",disabled:s(f)||!s(q),class:"px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[s(f)?(o(),R(c,{key:0,name:"heroicons:arrow-path",class:"w-4 h-4 inline mr-2 animate-spin"})):(o(),R(c,{key:1,name:"heroicons:paper-airplane",class:"w-4 h-4 inline mr-2"})),w(" "+u(s(f)?"Publication...":"Publier la critique"),1)],8,dt)):g("",!0)])])],32)])])])}}}),yt=se(ut,[["__scopeId","data-v-b422e7cd"]]);export{yt as default};
