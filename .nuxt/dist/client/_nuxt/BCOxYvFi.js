import{f as ce,v as de,H as j,u as O,g as u,h as ue,G as ge,c as l,n as d,k as a,a as e,b as g,t as c,w as M,F as v,l as x,z as k,M as I,y as me,A as ye,j as ve,e as xe,r as pe,o as n,d as G,B as A,m as _e,_ as he}from"./CCeOfYC8.js";import{_ as fe}from"./9m6yv6gx.js";import{u as be}from"./C-EV01kC.js";import{u as ke}from"./C_YtV1it.js";import{u as we}from"./BenXJgZx.js";import{u as Ce}from"./B9jFdIe5.js";import"./2MIT5xPl.js";import"./SwZ-OZp_.js";const Re={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},$e={key:0,class:"flex items-center justify-center py-12"},Me={key:1,class:"container mx-auto px-4 py-8"},Ie={class:"rounded-md bg-red-50 dark:bg-red-900/20 p-4"},Ae={class:"flex"},Ne={class:"ml-3"},Se={class:"mt-2 text-sm text-red-700 dark:text-red-300"},qe={key:2,class:"container mx-auto px-4 py-8"},De={class:"flex mb-8","aria-label":"Breadcrumb"},Ee={class:"flex items-center space-x-4"},Le={class:"flex items-center"},je={class:"flex items-center"},Ue={class:"ml-4 text-sm font-medium text-gray-900 dark:text-white"},ze={class:"main bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden"},Pe={class:"fiche p-8"},Ve={class:"text-4xl font-bold text-gray-900 dark:text-white mb-6"},Be={class:"general grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8"},Te={class:"principal lg:col-span-1"},Fe={class:"img-fiche mb-6"},He=["src","alt"],Oe={class:"space-y-3 text-sm"},Ge={key:0,class:"flex"},Ke={class:"text-gray-900 dark:text-white"},Je={key:1,class:"flex"},Qe={class:"text-gray-900 dark:text-white"},We={key:2,class:"flex"},Xe={class:"text-gray-900 dark:text-white"},Ye={key:3,class:"flex"},Ze={class:"text-gray-900 dark:text-white"},et={key:4,class:"flex"},tt={class:"text-gray-900 dark:text-white"},st={key:5,class:"flex"},at={class:"text-gray-900 dark:text-white"},ot={key:6,class:"flex items-center"},rt={class:"flex items-center"},nt={class:"flex text-yellow-400"},lt={class:"ml-2 text-gray-900 dark:text-white"},it={key:0,class:"ml-1 text-gray-500 dark:text-gray-400 text-xs"},ct={class:"lg:col-span-2"},dt={id:"tabs",class:"ui-tabs"},ut={class:"fiche-menu mb-6"},gt={class:"flex border-b border-gray-200 dark:border-gray-700"},mt=["onClick"],yt={class:"tab-content"},vt={class:"info synopsis"},xt={key:0,class:"prose dark:prose-invert max-w-none"},pt=["innerHTML"],_t={key:1,class:"text-gray-500 dark:text-gray-400 italic"},ht={class:"info reviews"},ft={class:"space-y-4"},bt={class:"flex items-center justify-between"},kt={class:"text-lg font-medium text-gray-900 dark:text-white"},wt={key:0,class:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"},Ct={class:"flex items-center space-x-1"},Rt=["onClick"],$t={class:"flex space-x-3"},Mt={key:1,class:"space-y-4"},It={class:"flex items-start justify-between mb-2"},At={class:"flex items-center space-x-2"},Nt={class:"font-medium text-gray-900 dark:text-white"},St={class:"flex text-yellow-400"},qt={class:"text-sm text-gray-600 dark:text-gray-400"},Dt={class:"text-xs text-gray-500 dark:text-gray-400"},Et={key:0,class:"font-medium text-gray-900 dark:text-white mb-1"},Lt={class:"text-gray-700 dark:text-gray-300"},jt={key:2,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Ut={key:3,class:"text-center py-4"},zt={class:"info relations"},Pt={class:"info notes"},Vt={key:0,class:"screenshots mt-8"},Bt={class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"},Tt=["onClick"],Ft=["src","alt"],Ht={key:0,class:"simama bg-gray-50 dark:bg-gray-800 p-8"},Ot={class:"similaires-main"},Gt={class:"bloc sim"},Kt={class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"},Jt=["src","alt"],Qt={class:"mt-2 text-sm text-gray-700 dark:text-gray-300 text-center line-clamp-2"},Wt={class:"mt-6 text-center"},Xt={class:"relative max-w-4xl max-h-full p-4"},Yt=["src","alt"],Zt=ce({__name:"[slug]",setup(es){const N=de(),U=j(()=>N.params.slug),w=j(()=>{const o=U.value.split("-"),t=o[o.length-1];return/^\d+$/.test(t)?t:null});O({title:"Chargement...",meta:[{name:"description",content:"Chargement des détails du manga..."}]});const s=u(null),S=u([]),q=u([]),C=u(!0),R=u(!1),D=u(!1),z=u([]),p=u(""),_=u("synopsis"),f=u(!1),E=u(!1),P=u(0),m=u([]),K=[{id:"synopsis",label:"Synopsis"},{id:"reviews",label:"Critiques"},{id:"relations",label:"Relations"},{id:"notes",label:"Notes"}],h=u({critique:"",notation:5}),V=be(),B=ke(),{fetchMangaRelations:J}=we(),Q=ve(),T=j(()=>m.value[P.value]),W=o=>`/manga/${o.niceUrl||X(o.titre)}-${o.id}`,X=o=>o.toLowerCase().replace(/[àáâãäå]/g,"a").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/[ýÿ]/g,"y").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),L=async()=>{if(!w.value){p.value="ID manga invalide dans l'URL",C.value=!1;return}try{C.value=!0,p.value="",console.log("Loading manga with ID:",w.value);const o=await V.fetchMangaById(parseInt(w.value));console.log("Manga API response:",o),s.value=o,s.value&&(O({title:`${s.value.titre} - Anime-Kun V2`,meta:[{name:"description",content:s.value.synopsis||`Découvrez ${s.value.titre}, un manga${s.value.annee?` de ${s.value.annee}`:""}.`},{property:"og:title",content:s.value.titre},{property:"og:description",content:s.value.synopsis||`Découvrez ${s.value.titre}`},{property:"og:image",content:b(s.value.image,"manga")},{property:"og:type",content:"book"}]}),F(),Y(),Z(),ee())}catch(o){console.error("Error loading manga:",o),p.value=o.message||"Erreur lors du chargement du manga"}finally{C.value=!1}},F=async()=>{if(s.value)try{R.value=!0;const o=await B.fetchReviews({idManga:s.value.id,limit:10});S.value=o.reviews||o.data||[]}catch(o){console.error("Error loading reviews:",o)}finally{R.value=!1}},Y=async()=>{if(s.value)try{const o=await V.fetchMangas({auteur:s.value.auteur,limit:6}),t=o.mangas||o.data||[];q.value=t.filter(i=>i.id!==s.value.id).slice(0,6)}catch(o){console.error("Error loading similar mangas:",o)}},Z=async()=>{if(s.value)try{const t=await $fetch(`${Q.public.apiBase}/api/media/content/${s.value.id}?type=manga`)||[];if(m.value=[],m.value.length===0&&s.value.image){const i=b(s.value.image,"manga");i&&(m.value=[{thumb:i,full:i}])}}catch{if(console.log("No screenshots found for manga:",s.value.id),s.value.image){const t=b(s.value.image,"manga");t&&(m.value=[{thumb:t,full:t}])}else m.value=[]}},ee=async()=>{if(s.value)try{D.value=!0;const o=await J(s.value.id);o&&(z.value=o.relations||[])}catch(o){console.error("Error loading relations:",o)}finally{D.value=!1}},te=async()=>{if(s.value)try{await B.createReview({...h.value,idManga:s.value.id}),h.value={critique:"",notation:5},f.value=!1,F(),s.value.nbReviews!==void 0&&s.value.nbReviews++}catch(o){p.value=o.message||"Erreur lors de l'ajout de la critique"}},se=o=>o.replace(/\n/g,"<br>").replace(/<span class="italic">(.*?)<\/span>/g,"<em>$1</em>").replace(/<span class="auteur">(.*?)<\/span>/g,'<small class="text-gray-500 dark:text-gray-400">$1</small>'),ae=o=>new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}),oe=o=>{P.value=o,E.value=!0},H=()=>{E.value=!1},re=o=>{const t=o.target;t.src="/images/placeholder-manga.jpg"},ne=o=>{const i=o.target.closest(".relative.group.cursor-pointer");i&&(i.style.display="none")},le=o=>{const i=o.target.closest(".relative.group.cursor-pointer");i&&(i.style.display="block")},{getImageUrl:b}=Ce();return ue(()=>{console.log("Manga details page mounted with slug:",U.value),console.log("Extracted manga ID:",w.value),L()}),ge(()=>N.params.slug,()=>{N.params.slug&&L()}),(o,t)=>{const i=pe("Icon"),$=xe,ie=fe;return n(),l("div",Re,[a(C)?(n(),l("div",$e,t[3]||(t[3]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent"},null,-1),e("span",{class:"ml-3 text-gray-600 dark:text-gray-300"},"Chargement du manga...",-1)]))):a(p)?(n(),l("div",Me,[e("div",Ie,[e("div",Ae,[g(i,{name:"heroicons:exclamation-triangle",class:"h-5 w-5 text-red-400"}),e("div",Ne,[t[4]||(t[4]=e("h3",{class:"text-sm font-medium text-red-800 dark:text-red-200"}," Erreur de chargement ",-1)),e("div",Se,c(a(p)),1),e("div",{class:"mt-4"},[e("button",{onClick:L,class:"btn-primary"}," Réessayer ")])])])])])):a(s)?(n(),l("div",qe,[e("nav",De,[e("ol",Ee,[e("li",null,[g($,{to:"/",class:"text-gray-400 hover:text-gray-500 dark:text-gray-500 dark:hover:text-gray-400"},{default:M(()=>[g(i,{name:"heroicons:home",class:"h-5 w-5"}),t[5]||(t[5]=e("span",{class:"sr-only"},"Accueil",-1))]),_:1,__:[5]})]),e("li",null,[e("div",Le,[g(i,{name:"heroicons:chevron-right",class:"h-5 w-5 text-gray-400"}),g($,{to:"/mangas",class:"ml-4 text-sm font-medium text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"},{default:M(()=>t[6]||(t[6]=[G(" Mangas ",-1)])),_:1,__:[6]})])]),e("li",null,[e("div",je,[g(i,{name:"heroicons:chevron-right",class:"h-5 w-5 text-gray-400"}),e("span",Ue,c(a(s).titre),1)])])])]),e("div",ze,[e("div",Pe,[e("h1",Ve,c(a(s).titre),1),e("div",Be,[e("div",Te,[e("div",Fe,[e("img",{src:a(b)(a(s).image,"manga"),alt:a(s).titre,class:"w-full max-w-sm mx-auto rounded-lg shadow-md",onError:re},null,40,He)]),e("div",Oe,[a(s).annee?(n(),l("div",Ge,[t[7]||(t[7]=e("span",{class:"font-medium text-gray-700 dark:text-gray-300 mr-2"},"Année :",-1)),e("span",Ke,c(a(s).annee),1)])):d("",!0),a(s).titreOrig?(n(),l("div",Je,[t[8]||(t[8]=e("span",{class:"font-medium text-gray-700 dark:text-gray-300 mr-2"},"Titre original :",-1)),e("span",Qe,c(a(s).titreOrig),1)])):d("",!0),a(s).auteur?(n(),l("div",We,[t[9]||(t[9]=e("span",{class:"font-medium text-gray-700 dark:text-gray-300 mr-2"},"Auteur :",-1)),e("span",Xe,c(a(s).auteur),1)])):d("",!0),a(s).nbVolumes?(n(),l("div",Ye,[t[10]||(t[10]=e("span",{class:"font-medium text-gray-700 dark:text-gray-300 mr-2"},"Nombre de volumes :",-1)),e("span",Ze,c(a(s).nbVolumes),1)])):d("",!0),a(s).editeur?(n(),l("div",et,[t[11]||(t[11]=e("span",{class:"font-medium text-gray-700 dark:text-gray-300 mr-2"},"Éditeur :",-1)),e("span",tt,c(a(s).editeur),1)])):d("",!0),a(s).dessinateur?(n(),l("div",st,[t[12]||(t[12]=e("span",{class:"font-medium text-gray-700 dark:text-gray-300 mr-2"},"Dessinateur :",-1)),e("span",at,c(a(s).dessinateur),1)])):d("",!0),a(s).moyenneNotes?(n(),l("div",ot,[t[13]||(t[13]=e("span",{class:"font-medium text-gray-700 dark:text-gray-300 mr-2"},"Note moyenne :",-1)),e("div",rt,[e("div",nt,[(n(),l(v,null,x(5,r=>g(i,{key:r,name:"heroicons:star-solid",class:A([r<=Math.round(a(s).moyenneNotes/2)?"text-yellow-400":"text-gray-300 dark:text-gray-600","h-4 w-4"])},null,8,["class"])),64))]),e("span",lt,c((a(s).moyenneNotes/2).toFixed(1))+"/5",1),a(s).nbReviews?(n(),l("span",it," ("+c(a(s).nbReviews)+" avis) ",1)):d("",!0)])])):d("",!0)])]),e("div",ct,[e("div",dt,[e("div",ut,[e("ul",gt,[(n(),l(v,null,x(K,r=>e("li",{key:r.id,class:"mr-2"},[e("button",{onClick:y=>_.value=r.id,class:A(["inline-block py-4 px-6 text-sm font-medium border-b-2 transition-colors",a(_)===r.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"])},c(r.label),11,mt)])),64))])]),e("div",yt,[k(e("div",vt,[a(s).synopsis?(n(),l("div",xt,[e("p",{innerHTML:se(a(s).synopsis)},null,8,pt)])):(n(),l("div",_t," Aucun synopsis disponible pour ce manga. "))],512),[[I,a(_)==="synopsis"]]),k(e("div",ht,[e("div",ft,[e("div",bt,[e("h3",kt," Critiques ("+c(a(s).nbReviews||0)+") ",1),e("button",{onClick:t[0]||(t[0]=r=>f.value=!a(f)),class:"btn-primary"}," Ajouter une critique ")]),a(f)?(n(),l("div",wt,[e("form",{onSubmit:me(te,["prevent"]),class:"space-y-4"},[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Note ",-1)),e("div",Ct,[(n(),l(v,null,x(10,r=>e("button",{key:r,type:"button",onClick:y=>a(h).notation=r,class:"focus:outline-none"},[g(i,{name:"heroicons:star-solid",class:A([r<=a(h).notation?"text-yellow-400":"text-gray-300 dark:text-gray-600","h-6 w-6 hover:text-yellow-400 transition-colors"])},null,8,["class"])],8,Rt)),64))])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Votre critique ",-1)),k(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=r=>a(h).critique=r),rows:"4",class:"form-input",placeholder:"Partagez votre avis sur ce manga...",required:""},null,512),[[ye,a(h).critique]])]),e("div",$t,[t[16]||(t[16]=e("button",{type:"submit",class:"btn-primary"}," Publier ",-1)),e("button",{type:"button",onClick:t[2]||(t[2]=r=>f.value=!1),class:"btn-secondary"}," Annuler ")])],32)])):d("",!0),a(S).length?(n(),l("div",Mt,[(n(!0),l(v,null,x(a(S),r=>(n(),l("div",{key:r.id,class:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"},[e("div",It,[e("div",At,[e("span",Nt,c(r.membre?.memberName||"Utilisateur"),1),e("div",St,[(n(),l(v,null,x(5,y=>g(i,{key:y,name:"heroicons:star-solid",class:A([y<=Math.round((r.notation||0)/2)?"text-yellow-400":"text-gray-300 dark:text-gray-600","h-4 w-4"])},null,8,["class"])),64))]),e("span",qt,c(r.notation)+"/10 ",1)]),e("span",Dt,c(ae(r.reviewDate||r.dateCritique)),1)]),r.titre?(n(),l("h4",Et,c(r.titre),1)):d("",!0),e("p",Lt,c(r.critique),1)]))),128))])):a(R)?d("",!0):(n(),l("div",jt," Aucune critique pour ce manga. Soyez le premier à donner votre avis ! ")),a(R)?(n(),l("div",Ut,t[17]||(t[17]=[e("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-blue-500 border-t-transparent mx-auto"},null,-1)]))):d("",!0)])],512),[[I,a(_)==="reviews"]]),k(e("div",zt,[g(ie,{relations:a(z),loading:a(D),title:"Contenus liés"},null,8,["relations","loading"])],512),[[I,a(_)==="relations"]]),k(e("div",Pt,t[18]||(t[18]=[e("div",{class:"text-gray-500 dark:text-gray-400 italic"}," Aucune note supplémentaire disponible. ",-1)]),512),[[I,a(_)==="notes"]])])])])]),a(m).length?(n(),l("div",Vt,[t[20]||(t[20]=e("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"},"Illustrations",-1)),e("div",Bt,[(n(!0),l(v,null,x(a(m),(r,y)=>(n(),l("div",{key:y,class:"relative group cursor-pointer",onClick:ts=>oe(y)},[e("img",{src:r.thumb,alt:`${a(s).titre} - Illustration #${y+1}`,class:"w-full h-16 object-cover rounded-lg transition-transform group-hover:scale-105",onError:ne,onLoad:le},null,40,Ft),t[19]||(t[19]=e("div",{class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-opacity rounded-lg"},null,-1))],8,Tt))),128))])])):d("",!0)]),a(q).length?(n(),l("div",Ht,[e("div",Ot,[e("div",Gt,[t[22]||(t[22]=e("h4",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-6"},"Mangas similaires",-1)),e("div",Kt,[(n(!0),l(v,null,x(a(q),r=>(n(),_e($,{key:r.id,to:W(r),class:"group"},{default:M(()=>[e("img",{src:a(b)(r.image,"manga"),alt:r.titre,class:"w-full aspect-[3/4] object-cover rounded-lg transition-transform group-hover:scale-105"},null,8,Jt),e("p",Qt,c(r.titre),1)]),_:2},1032,["to"]))),128))]),e("div",Wt,[g($,{to:`/mangas/similaires/${a(s).id}`,class:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm"},{default:M(()=>t[21]||(t[21]=[G(" Plus de mangas similaires » ",-1)])),_:1,__:[21]},8,["to"])])])])])):d("",!0)])])):d("",!0),a(E)?(n(),l("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90",onClick:H},[e("div",Xt,[e("button",{onClick:H,class:"absolute top-2 right-2 text-white hover:text-gray-300 z-10"},[g(i,{name:"heroicons:x-mark",class:"h-8 w-8"})]),a(T)?(n(),l("img",{key:0,src:a(T).full,alt:`${a(s)?.titre} - Illustration`,class:"max-w-full max-h-full object-contain"},null,8,Yt)):d("",!0)])])):d("",!0)])}}}),ds=he(Zt,[["__scopeId","data-v-7c3f8167"]]);export{ds as default};
