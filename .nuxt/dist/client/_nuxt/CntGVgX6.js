import{f as V,q as B,g as k,H as u,h as N,c as m,a as t,k as i,b as c,B as w,t as l,w as I,p as z,v as H,r as P,e as Y,o as g,d as C,_ as G}from"./CCeOfYC8.js";import K from"./B3ebZBhz.js";import{u as O}from"./B9jFdIe5.js";const J={class:"review-card group bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md hover:border-gray-300 dark:hover:border-gray-600 transition-all duration-200 overflow-hidden"},Q={class:"review-header p-4 pb-3"},W={class:"flex items-start space-x-3"},X={class:"flex-shrink-0 relative"},Z={key:0,class:"w-12 h-16 rounded-md shadow-sm overflow-hidden bg-gray-100 dark:bg-gray-800"},ee=["src","alt"],te={key:1,class:"w-12 h-16 bg-gradient-to-br from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-800 rounded-md flex items-center justify-center"},re={class:"flex-1 min-w-0"},oe={class:"flex items-center justify-between mb-1"},ae={class:"text-xs font-medium text-gray-600 dark:text-gray-400 truncate"},ie={class:"flex items-center space-x-1 flex-shrink-0 ml-2"},se={class:"text-xs text-gray-500"},ne={class:"review-content px-4 pb-4"},le={class:"review-title text-lg font-semibold text-gray-900 dark:text-white mb-2 line-clamp-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"},ce={class:"review-excerpt text-sm text-gray-600 dark:text-gray-300 mb-4"},de={class:"line-clamp-3 leading-relaxed"},ue={class:"review-footer px-4 pb-4"},me={class:"flex items-center justify-between"},ge={class:"flex items-center space-x-2"},ve={class:"w-7 h-7 rounded-full overflow-hidden flex-shrink-0"},he=["src","alt"],fe={class:"flex flex-col min-w-0"},we={class:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate"},pe={class:"text-xs text-gray-500 dark:text-gray-400"},be={class:"flex items-center space-x-1"},xe=["title"],ye=V({__name:"ReviewCard",props:{review:{}},emits:["favorite","view"],setup(A,{emit:U}){const o=A,R=U,p=B(),{getImageUrl:M}=O(),s=k(!1),h=k(!0),n=u(()=>o.review.idManga&&o.review.idManga>0?"manga":"anime"),b=u(()=>o.review.manga?.titre?o.review.manga.titre:o.review.anime?.titre?o.review.anime.titre:n.value==="manga"?"Manga":"Anime"),x=u(()=>{let e=null;n.value==="manga"?e=o.review.manga?.image||o.review.manga?.imageUrl:e=o.review.anime?.image||o.review.anime?.imageUrl;const r=e?M(e,n.value):null;return console.log("MediaImage debug:",{image:e,imageUrl:r,mediaType:n.value,manga:o.review.manga,anime:o.review.anime,fullReview:o.review}),r}),f=u(()=>`/review/${o.review.id||o.review.idCritique}`),y=u(()=>{if(!o.review.critique)return"";let e=o.review.critique.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&[^;]+;/g,"").replace(/\r\n/g," ").replace(/\n/g," ").trim();if(e.length>150){const r=e.substring(0,150),a=r.lastIndexOf(" ");e=(a>100?r.substring(0,a):r)+"..."}return e}),T=e=>{if(!e)return"";const r=new Date(e),a=new Date,v=Math.abs(a.getTime()-r.getTime()),d=Math.ceil(v/(1e3*60*60*24));if(d===1)return"Hier";if(d<7)return`Il y a ${d} jours`;if(d<30){const _=Math.floor(d/7);return`Il y a ${_} semaine${_>1?"s":""}`}else return r.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:r.getFullYear()!==a.getFullYear()?"numeric":void 0})},q=e=>!e||e===0?"0":e>=1e3?Math.floor(e/1e3)+"k":e.toString(),j=e=>e?e.charAt(0).toUpperCase():"U",E=e=>{if(!e)return"from-gray-500 to-gray-600";const r=["from-blue-500 to-blue-600","from-purple-500 to-purple-600","from-green-500 to-green-600","from-red-500 to-red-600","from-yellow-500 to-yellow-600","from-pink-500 to-pink-600","from-indigo-500 to-indigo-600","from-teal-500 to-teal-600"],a=e.charCodeAt(0)%r.length;return r[a]},$=e=>{const r=e.target;console.log("Image error:",{src:r.src,originalImage:o.review.manga?.image||o.review.anime?.image,mediaType:n.value,review:o.review}),h.value=!1},D=e=>{console.log("Image loaded successfully"),h.value=!0},L=e=>{const r=e.target;r.style.display="none"},S=async()=>{if(!p.isAuthenticated){z("/login?redirect="+encodeURIComponent(H().fullPath));return}try{s.value=!s.value,R("favorite",o.review.id||o.review.idCritique,s.value)}catch(e){console.error("Error toggling favorite:",e),s.value=!s.value}},F=async()=>{const e=`${window.location.origin}${f.value}`,r=`Critique: ${o.review.titre}`;if(navigator.share)try{await navigator.share({title:r,text:y.value||"DÃ©couvrez cette critique sur Anime-Kun",url:e})}catch(a){console.log("Sharing cancelled or failed:",a)}else try{await navigator.clipboard.writeText(e),console.log("URL copied to clipboard")}catch(a){console.error("Error copying to clipboard:",a)}};return N(async()=>{p.isAuthenticated}),(e,r)=>{const a=P("Icon"),v=Y;return g(),m("article",J,[t("div",Q,[t("div",W,[t("div",X,[i(x)&&i(h)?(g(),m("div",Z,[t("img",{src:i(x),alt:i(b),class:"w-full h-full object-cover rounded-md",onError:$,onLoad:D},null,40,ee)])):(g(),m("div",te,[c(a,{name:i(n)==="manga"?"heroicons:book-open":"heroicons:film",class:"w-5 h-5 text-gray-400"},null,8,["name"])])),t("div",{class:w(["absolute -bottom-1 -right-1 px-1.5 py-0.5 text-xs font-medium rounded-full border border-white dark:border-gray-800",i(n)==="manga"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"])},l(i(n)==="manga"?"M":"A"),3)]),t("div",re,[t("div",oe,[t("h4",ae,l(i(b)),1),t("div",ie,[c(a,{name:"heroicons:eye",class:"w-3 h-3 text-gray-400"}),t("span",se,l(q(e.review.nbClics)),1)])]),c(K,{"model-value":e.review.notation,mode:"display",size:"sm","show-max-value":!1},null,8,["model-value"])])])]),t("div",ne,[t("h3",le,[c(v,{to:i(f),class:"hover:underline"},{default:I(()=>[C(l(e.review.titre),1)]),_:1},8,["to"])]),t("div",ce,[t("p",de,l(i(y)),1)])]),t("div",ue,[t("div",me,[t("div",ge,[t("div",ve,[e.review.membre?.avatar?(g(),m("img",{key:0,src:e.review.membre.avatar,alt:e.review.membre?.pseudo||"Utilisateur",class:"w-full h-full object-cover",onError:L},null,40,he)):(g(),m("div",{key:1,class:w(["w-full h-full flex items-center justify-center text-white font-medium text-xs",`bg-gradient-to-br ${E(e.review.membre?.pseudo)}`])},l(j(e.review.membre?.pseudo)),3))]),t("div",fe,[t("span",we,l(e.review.membre?.pseudo||"Utilisateur"),1),t("span",pe,l(T(e.review.dateCritique)),1)])]),t("div",be,[t("button",{onClick:S,class:w(["p-1 rounded-full transition-colors",i(s)?"text-red-500 hover:text-red-600 bg-red-50 dark:bg-red-900/20":"text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20"]),title:i(s)?"Retirer des favoris":"Ajouter aux favoris"},[c(a,{name:i(s)?"heroicons:heart-solid":"heroicons:heart",class:"w-3 h-3"},null,8,["name"])],10,xe),t("button",{onClick:F,class:"p-1 rounded-full text-gray-400 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",title:"Partager la critique"},[c(a,{name:"heroicons:share",class:"w-3 h-3"})]),c(v,{to:i(f),class:"px-2 py-1 text-xs font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors"},{default:I(()=>r[0]||(r[0]=[C(" Lire plus ",-1)])),_:1,__:[0]},8,["to"])])])]),r[1]||(r[1]=t("div",{class:"absolute inset-0 bg-blue-500/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none rounded-xl"},null,-1))])}}}),Ce=G(ye,[["__scopeId","data-v-43f4a9aa"]]);export{Ce as default};
