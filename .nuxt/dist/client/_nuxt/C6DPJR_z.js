import R from"./B9zOjE0W.js";import{f as W,u as j,g as d,x as H,H as K,h as L,v as B,G,c as i,a as r,n as O,k as o,F as x,l as f,z as u,b as z,A as $,K as k,D as J,t as v,p as V,r as X,o as l,m as E,_ as Y}from"./CCeOfYC8.js";import{u as Z}from"./Hes4McSu.js";import{u as Q}from"./DSActBeb.js";import{u as ee}from"./BYwTe9_t.js";import"./2MIT5xPl.js";import"./SwZ-OZp_.js";import"./B9jFdIe5.js";const te={class:"bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 py-16"},re={class:"max-w-7xl mx-auto px-6 md:px-8 lg:px-12"},se={key:0,class:"mb-16"},ae={class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8"},oe={class:"main-content"},le={class:"mb-8"},ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ne={class:"relative"},de=["value"],ce=["value"],ue={class:"mt-4 flex flex-wrap items-center gap-4"},me={class:"flex items-center space-x-2"},ge={class:"text-sm text-gray-500 dark:text-gray-400"},pe={key:0,class:"flex items-center justify-center py-12"},ye={key:1,class:"rounded-md bg-red-50 dark:bg-red-900/20 p-4 mb-8"},xe={class:"flex"},fe={class:"ml-3"},ve={class:"mt-2 text-sm text-red-700 dark:text-red-300"},be={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},he=W({__name:"index",setup(ke){j({title:"Webzine - Anime-Kun",meta:[{name:"description",content:"Découvrez notre webzine, actualités et analyses sur l'univers des animes et mangas"},{name:"keywords",content:"webzine, articles, anime, manga, actualités, analyses, critiques"}]});const I=d([]),b=d([]),A=d([]),w=d([]),h=d(!0),m=d(""),_=d(0),F=d(),s=H({page:1,limit:6,search:"",categoryId:void 0,authorId:void 0,sortBy:"date",sortOrder:!0}),g=Z(),M=Q(),P=K(()=>!!(s.search||s.categoryId||s.authorId||s.sortBy!=="date")),p=async()=>{try{h.value=!0,m.value="";const e=Object.entries({...s,sortOrder:s.sortOrder?"desc":"asc"}).reduce((n,[y,a])=>(a!==""&&a!==null&&a!==void 0&&(n[y]=a),n),{}),t=await g.fetchArticles(e);I.value=t.articles||[],F.value=t.pagination||{totalItems:0,totalPages:0,currentPage:1,pageSize:12},_.value=t.pagination?.totalItems||0}catch(e){m.value=g.error.value||"Erreur lors du chargement des articles",console.error("Error loading articles:",e)}finally{h.value=!1}},D=async()=>{try{const e=await g.fetchFeaturedArticles(5);b.value=e}catch(e){console.error("Error loading featured articles:",e)}},S=async()=>{try{const e=await M.fetchCategories();A.value=e}catch(e){console.error("Error loading categories:",e)}},T=async()=>{try{const e=await g.fetchArticles({limit:100}),t=new Map;e&&e.articles&&Array.isArray(e.articles)&&e.articles.forEach(n=>{n.author&&!t.has(n.author.idMember)&&t.set(n.author.idMember,n.author)}),w.value=Array.from(t.values())}catch(e){console.error("Error loading authors:",e)}},c=()=>{s.page=1,p();const e={};s.search&&(e.search=s.search),s.categoryId&&(e.category=s.categoryId.toString()),s.authorId&&(e.author=s.authorId.toString()),s.sortBy!=="date"&&(e.sort=s.sortBy),s.sortOrder||(e.order="asc"),V({query:e},{replace:!0})},C=ee(()=>{c()},500),U=()=>{s.search="",s.categoryId=void 0,s.authorId=void 0,s.sortBy="date",s.sortOrder=!0,c()},q=e=>{V(`/articles/${e.niceUrl}`)},N=async()=>{await Promise.allSettled([D(),S(),T(),p()])};return L(()=>{const e=B();e.query.search&&(s.search=e.query.search),e.query.category&&(s.categoryId=parseInt(e.query.category)),e.query.author&&(s.authorId=parseInt(e.query.author)),e.query.sort&&(s.sortBy=e.query.sort),e.query.order&&(s.sortOrder=e.query.order==="desc"),e.query.page&&(s.page=parseInt(e.query.page)||1),N()}),G(()=>B().query,e=>{e.page&&(s.page=parseInt(e.page)||1,p())},{immediate:!1}),(e,t)=>{const n=R,y=X("Icon");return l(),i("div",null,[r("section",te,[r("div",re,[t[7]||(t[7]=r("div",{class:"text-center mb-12"},[r("h1",{class:"text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 dark:text-white mb-6"}," Webzine "),r("p",{class:"text-lg md:text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto"}," Découvrez notre webzine, actualités et analyses sur l'univers des animes et mangas ")],-1)),o(b).length>0?(l(),i("div",se,[t[6]||(t[6]=r("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white mb-8 text-center"}," Webzine à la une ",-1)),r("div",ae,[(l(!0),i(x,null,f(o(b).slice(0,3),a=>(l(),E(n,{key:a.idArt,article:a,onView:q,class:"featured-article-card transform hover:scale-105 transition-all duration-300 shadow-lg"},null,8,["article"]))),128))])])):O("",!0)])]),r("div",oe,[r("div",le,[r("div",ie,[r("div",null,[t[8]||(t[8]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Recherche ",-1)),r("div",ne,[u(r("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>o(s).search=a),type:"text",placeholder:"Titre de l'article...",class:"form-input pl-10",onInput:t[1]||(t[1]=(...a)=>o(C)&&o(C)(...a))},null,544),[[$,o(s).search]]),z(y,{name:"heroicons:magnifying-glass",class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})])]),r("div",null,[t[10]||(t[10]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Catégorie ",-1)),u(r("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>o(s).categoryId=a),class:"form-input",onChange:c},[t[9]||(t[9]=r("option",{value:""},"Toutes les catégories",-1)),(l(!0),i(x,null,f(o(A),a=>(l(),i("option",{key:a.id,value:a.id},v(a.name),9,de))),128))],544),[[k,o(s).categoryId]])]),r("div",null,[t[12]||(t[12]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Auteur ",-1)),u(r("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>o(s).authorId=a),class:"form-input",onChange:c},[t[11]||(t[11]=r("option",{value:""},"Tous les auteurs",-1)),(l(!0),i(x,null,f(o(w),a=>(l(),i("option",{key:a.idMember,value:a.idMember},v(a.memberName),9,ce))),128))],544),[[k,o(s).authorId]])]),r("div",null,[t[14]||(t[14]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Trier par ",-1)),u(r("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>o(s).sortBy=a),class:"form-input",onChange:c},t[13]||(t[13]=[r("option",{value:"date"},"Date de publication",-1),r("option",{value:"titre"},"Titre",-1),r("option",{value:"nbClics"},"Popularité",-1),r("option",{value:"commentCount"},"Commentaires",-1)]),544),[[k,o(s).sortBy]])])]),r("div",ue,[r("div",me,[u(r("input",{id:"sortOrder","onUpdate:modelValue":t[5]||(t[5]=a=>o(s).sortOrder=a),type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",onChange:c},null,544),[[J,o(s).sortOrder]]),t[15]||(t[15]=r("label",{for:"sortOrder",class:"text-sm text-gray-700 dark:text-gray-300"}," Ordre décroissant ",-1))]),r("div",ge,v(o(_))+" articles trouvés ",1),o(P)?(l(),i("button",{key:0,onClick:U,class:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors duration-200"}," Effacer les filtres ")):O("",!0)])]),o(h)?(l(),i("div",pe,t[16]||(t[16]=[r("div",{class:"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent"},null,-1),r("span",{class:"ml-3 text-gray-600 dark:text-gray-300"},"Chargement des articles...",-1)]))):o(m)?(l(),i("div",ye,[r("div",xe,[z(y,{name:"heroicons:exclamation-triangle",class:"h-5 w-5 text-red-400"}),r("div",fe,[t[17]||(t[17]=r("h3",{class:"text-sm font-medium text-red-800 dark:text-red-200"}," Erreur de chargement ",-1)),r("div",ve,v(o(m)),1),r("div",{class:"mt-4"},[r("button",{onClick:p,class:"btn-primary"}," Réessayer ")])])])])):(l(),i("div",be,[(l(!0),i(x,null,f(o(I),a=>(l(),E(n,{key:a.idArt,article:a,onView:q},null,8,["article"]))),128))]))])])}}}),ze=Y(he,[["__scopeId","data-v-c410380b"]]);export{ze as default};
