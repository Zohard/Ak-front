import{f as W,q as X,I as Y,g,x as ee,H as te,h as se,U as re,c as d,a as t,b as o,w as b,t as i,k as n,n as ae,z as w,A as oe,J as k,K as C,E,F as P,l as T,d as m,e as ie,p as ne,r as D,o as c,B as le,_ as de}from"./Bes98wj2.js";import{u as ce}from"./DMFesj3P.js";import{u as ue}from"./DzvRhcSF.js";const ge={class:"my-reviews-page"},me={class:"bg-gradient-to-r from-purple-600 to-blue-600 text-white"},pe={class:"container mx-auto px-6 py-12"},xe={class:"flex items-center justify-between"},ye={class:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700"},be={class:"container mx-auto px-6 py-8"},ve={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},he={class:"text-center"},fe={class:"text-3xl font-bold text-purple-600 mb-1"},_e={class:"text-center"},we={class:"text-3xl font-bold text-blue-600 mb-1"},ke={class:"text-center"},qe={class:"text-3xl font-bold text-yellow-600 mb-1"},Re={class:"text-center"},Ce={class:"text-3xl font-bold text-green-600 mb-1"},Pe={class:"container mx-auto px-6 py-8"},Te={class:"flex flex-col lg:flex-row gap-8"},Me={class:"flex-1"},Ve={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-8"},ze={class:"flex flex-col md:flex-row md:items-center gap-4"},Ae={class:"flex-1"},Ie={class:"relative"},Se={key:0,class:"space-y-6"},Ne={key:1,class:"text-center py-12"},Ee={class:"text-gray-600 dark:text-gray-400 mb-6"},De={key:2,class:"space-y-6"},je={class:"p-6"},Ue={class:"flex space-x-4"},Be={class:"flex-shrink-0"},Fe=["src","alt"],Le={key:1,class:"w-20 h-28 bg-gradient-to-br from-gray-200 to-gray-300 dark:from-gray-600 dark:to-gray-700 rounded-lg flex items-center justify-center"},$e={class:"flex-1 min-w-0"},Ge={class:"flex items-start justify-between mb-2"},Ke={class:"flex-1"},Je={class:"text-lg font-semibold text-gray-900 dark:text-white truncate"},He={class:"text-sm text-gray-600 dark:text-gray-400"},Oe={class:"flex items-center space-x-2 mb-3"},Qe={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Ze={class:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-4"},We={class:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-4"},Xe={class:"flex items-center space-x-4"},Ye={class:"flex items-center space-x-1"},et={class:"flex items-center space-x-1"},tt={class:"flex items-center space-x-1"},st={class:"flex items-center space-x-1"},rt={class:"capitalize"},at={class:"flex items-center space-x-3"},ot=["onClick"],it=["onClick"],nt={key:3,class:"text-center mt-8"},lt={class:"w-full lg:w-80 space-y-6"},dt={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"},ct={class:"space-y-3"},ut={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"},gt={class:"space-y-3 text-sm"},mt={class:"text-gray-700 dark:text-gray-300"},pt={class:"text-xs text-gray-500 dark:text-gray-400"},xt={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"},yt={class:"space-y-3 text-sm text-gray-600 dark:text-gray-400"},bt={class:"flex items-start space-x-2"},vt={class:"flex items-start space-x-2"},ht={class:"flex items-start space-x-2"},ft=W({__name:"my-reviews",async setup(_t){let M,V;X().isAuthenticated||([M,V]=Y(()=>ne("/login?redirect="+encodeURIComponent("/reviews/my-reviews"))),await M,V());const q=ce(),{getImageUrl:j}=ue(),f=g(!0),v=g([]),p=g(""),x=g(""),y=g(""),_=g("newest"),z=g(!1),A=g(1),l=ee({totalReviews:0,publishedReviews:0,averageRating:"0.0",totalViews:0}),U=g([{id:1,icon:"heroicons:document-plus",text:'Nouvelle critique publiée sur "One Piece"',date:"Il y a 2 jours"},{id:2,icon:"heroicons:chat-bubble-left",text:"3 nouveaux commentaires sur votre critique",date:"Il y a 3 jours"},{id:3,icon:"heroicons:heart",text:"5 utilisateurs ont aimé votre critique",date:"Il y a 1 semaine"}]),I=te(()=>{let s=[...v.value];if(p.value.trim()){const e=p.value.toLowerCase().trim();s=s.filter(r=>r.titre.toLowerCase().includes(e)||r.contenu.toLowerCase().includes(e)||R(r).toLowerCase().includes(e))}return x.value&&(s=s.filter(e=>{switch(x.value){case"published":return e.estPublique;case"private":return!e.estPublique;case"draft":return!e.estPublique;default:return!0}})),y.value&&(s=s.filter(e=>h(e)===y.value)),s.sort((e,r)=>{switch(_.value){case"newest":return new Date(r.dateCreation).getTime()-new Date(e.dateCreation).getTime();case"oldest":return new Date(e.dateCreation).getTime()-new Date(r.dateCreation).getTime();case"rating_high":return r.note-e.note;case"rating_low":return e.note-r.note;case"most_viewed":return(r.nbVues||0)-(e.nbVues||0);case"title":return e.titre.localeCompare(r.titre);default:return 0}}),s}),S=async(s=!1)=>{try{f.value=!s;const e=await q.getMyReviews({page:A.value,limit:10});s?v.value.push(...e.data):(v.value=e.data,l.totalReviews=e.total||e.data.length,l.publishedReviews=e.data.filter(r=>r.estPublique).length,l.averageRating=e.data.length>0?(e.data.reduce((r,u)=>r+u.note,0)/e.data.length).toFixed(1):"0.0",l.totalViews=e.data.reduce((r,u)=>r+(u.nbVues||0),0)),z.value=e.hasMore||!1}catch(e){console.error("Error loading reviews:",e)}finally{f.value=!1}},B=()=>{A.value++,S(!0)},h=s=>s.idManga&&s.idManga>0?"manga":"anime",R=s=>s.manga?.titre||s.anime?.titre||"Titre inconnu",N=s=>{const e=s.manga?.image||s.anime?.image;return e?j(e,h(s)):null},F=s=>s.estPublique?"Publié":"Privé",L=s=>s.estPublique?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300",$=s=>{const e=s.replace(/<[^>]*>/g,"").replace(/\[.*?\]/g,"");return e.length>150?e.substring(0,150)+"...":e},G=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),K=async s=>{try{await q.updateReview(s.id,{estPublique:!s.estPublique}),s.estPublique=!s.estPublique,s.estPublique?l.publishedReviews++:l.publishedReviews--}catch(e){console.error("Error updating review:",e),alert("Erreur lors de la mise à jour")}},J=async s=>{if(confirm("Êtes-vous sûr de vouloir supprimer cette critique ? Cette action est irréversible."))try{await q.deleteReview(s.id);const e=v.value.findIndex(r=>r.id===s.id);e>-1&&(v.value.splice(e,1),l.totalReviews--,s.estPublique&&l.publishedReviews--)}catch(e){console.error("Error deleting review:",e),alert("Erreur lors de la suppression")}},H=()=>{alert("Fonctionnalité d'export à venir")},O=s=>{const e=s.target;e.style.display="none"};return se(()=>{S()}),re({title:"Mes critiques - AK9",description:"Gérez et suivez toutes vos critiques d'animes et mangas",ogTitle:"Mes critiques - AK9",ogDescription:"Gérez et suivez toutes vos critiques d'animes et mangas",robots:"noindex, nofollow"}),(s,e)=>{const r=D("Icon"),u=ie,Q=D("ReviewRating");return c(),d("div",ge,[t("div",me,[t("div",pe,[t("div",xe,[e[5]||(e[5]=t("div",null,[t("h1",{class:"text-4xl font-bold mb-2"},"Mes critiques"),t("p",{class:"text-purple-100 text-lg"},"Gérez et suivez toutes vos critiques")],-1)),o(u,{to:"/reviews/create",class:"px-6 py-3 bg-white text-purple-600 rounded-lg font-semibold hover:bg-purple-50 transition-colors"},{default:b(()=>[o(r,{name:"heroicons:plus",class:"w-5 h-5 inline mr-2"}),e[4]||(e[4]=m(" Nouvelle critique ",-1))]),_:1,__:[4]})])])]),t("div",ye,[t("div",be,[t("div",ve,[t("div",he,[t("div",fe,i(n(l).totalReviews),1),e[6]||(e[6]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Total des critiques",-1))]),t("div",_e,[t("div",we,i(n(l).publishedReviews),1),e[7]||(e[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Publiées",-1))]),t("div",ke,[t("div",qe,i(n(l).averageRating),1),e[8]||(e[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Note moyenne",-1))]),t("div",Re,[t("div",Ce,i(n(l).totalViews),1),e[9]||(e[9]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Vues totales",-1))])])])]),t("div",Pe,[t("div",Te,[t("div",Me,[t("div",Ve,[t("div",ze,[t("div",Ae,[t("div",Ie,[w(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>k(p)?p.value=a:null),type:"text",placeholder:"Rechercher dans mes critiques...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},null,512),[[oe,n(p)]]),o(r,{name:"heroicons:magnifying-glass",class:"absolute left-3 top-2.5 w-5 h-5 text-gray-400"})])]),w(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>k(x)?x.value=a:null),class:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"},e[10]||(e[10]=[t("option",{value:""},"Tous les statuts",-1),t("option",{value:"published"},"Publiées",-1),t("option",{value:"draft"},"Brouillons",-1),t("option",{value:"private"},"Privées",-1)]),512),[[C,n(x)]]),w(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>k(y)?y.value=a:null),class:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"},e[11]||(e[11]=[t("option",{value:""},"Tous les types",-1),t("option",{value:"anime"},"Anime",-1),t("option",{value:"manga"},"Manga",-1)]),512),[[C,n(y)]]),w(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>k(_)?_.value=a:null),class:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"},e[12]||(e[12]=[E('<option value="newest" data-v-6eef3445>Plus récentes</option><option value="oldest" data-v-6eef3445>Plus anciennes</option><option value="rating_high" data-v-6eef3445>Note élevée</option><option value="rating_low" data-v-6eef3445>Note faible</option><option value="most_viewed" data-v-6eef3445>Plus vues</option><option value="title" data-v-6eef3445>Titre A-Z</option>',6)]),512),[[C,n(_)]])])]),n(f)?(c(),d("div",Se,[(c(),d(P,null,T(3,a=>t("div",{key:a,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 animate-pulse"},e[13]||(e[13]=[E('<div class="flex space-x-4" data-v-6eef3445><div class="w-20 h-28 bg-gray-300 dark:bg-gray-600 rounded" data-v-6eef3445></div><div class="flex-1 space-y-3" data-v-6eef3445><div class="h-6 bg-gray-300 dark:bg-gray-600 rounded w-3/4" data-v-6eef3445></div><div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-1/2" data-v-6eef3445></div><div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-full" data-v-6eef3445></div><div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-2/3" data-v-6eef3445></div></div></div>',1)]))),64))])):n(I).length===0?(c(),d("div",Ne,[o(r,{name:"heroicons:document-text",class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e[15]||(e[15]=t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"},"Aucune critique trouvée",-1)),t("p",Ee,i(n(p)||n(x)||n(y)?"Aucune critique ne correspond à vos critères de recherche.":"Vous n'avez pas encore écrit de critique."),1),o(u,{to:"/reviews/create",class:"inline-flex items-center px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"},{default:b(()=>[o(r,{name:"heroicons:plus",class:"w-5 h-5 mr-2"}),e[14]||(e[14]=m(" Écrire ma première critique ",-1))]),_:1,__:[14]})])):(c(),d("div",De,[(c(!0),d(P,null,T(n(I),a=>(c(),d("div",{key:a.id,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-md transition-shadow"},[t("div",je,[t("div",Ue,[t("div",Be,[N(a)?(c(),d("img",{key:0,src:N(a),alt:R(a),class:"w-20 h-28 object-cover rounded-lg shadow-sm",onError:O},null,40,Fe)):(c(),d("div",Le,[o(r,{name:h(a)==="manga"?"heroicons:book-open":"heroicons:film",class:"w-8 h-8 text-gray-400"},null,8,["name"])]))]),t("div",$e,[t("div",Ge,[t("div",Ke,[t("h3",Je,i(a.titre),1),t("p",He,i(R(a)),1)]),t("span",{class:le(["px-2 py-1 text-xs font-semibold rounded-full",L(a)])},i(F(a)),3)]),t("div",Oe,[o(Q,{rating:a.note,"max-rating":10,mode:"display",size:"sm"},null,8,["rating"]),t("span",Qe,i(a.note)+"/10",1)]),t("p",Ze,i($(a.contenu)),1),t("div",We,[t("div",Xe,[t("span",Ye,[o(r,{name:"heroicons:calendar",class:"w-4 h-4"}),t("span",null,i(G(a.dateCreation)),1)]),t("span",et,[o(r,{name:"heroicons:eye",class:"w-4 h-4"}),t("span",null,i(a.nbVues||0)+" vues",1)]),t("span",tt,[o(r,{name:"heroicons:chat-bubble-left",class:"w-4 h-4"}),t("span",null,i(a.nbCommentaires||0)+" commentaires",1)])]),t("div",st,[o(r,{name:h(a)==="manga"?"heroicons:book-open":"heroicons:film",class:"w-4 h-4"},null,8,["name"]),t("span",rt,i(h(a)),1)])]),t("div",at,[o(u,{to:`/review/${a.id||a.idCritique}`,class:"inline-flex items-center px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors"},{default:b(()=>[o(r,{name:"heroicons:eye",class:"w-4 h-4 mr-1"}),e[16]||(e[16]=m(" Voir ",-1))]),_:2,__:[16]},1032,["to"]),o(u,{to:`/reviews/${a.slug||a.id}/edit`,class:"inline-flex items-center px-3 py-1 text-sm bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"},{default:b(()=>[o(r,{name:"heroicons:pencil",class:"w-4 h-4 mr-1"}),e[17]||(e[17]=m(" Modifier ",-1))]),_:2,__:[17]},1032,["to"]),t("button",{onClick:Z=>K(a),class:"inline-flex items-center px-3 py-1 text-sm bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-colors"},[o(r,{name:a.estPublique?"heroicons:eye-slash":"heroicons:eye",class:"w-4 h-4 mr-1"},null,8,["name"]),m(" "+i(a.estPublique?"Masquer":"Publier"),1)],8,ot),t("button",{onClick:Z=>J(a),class:"inline-flex items-center px-3 py-1 text-sm bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition-colors"},[o(r,{name:"heroicons:trash",class:"w-4 h-4 mr-1"}),e[18]||(e[18]=m(" Supprimer ",-1))],8,it)])])])])]))),128))])),n(z)&&!n(f)?(c(),d("div",nt,[t("button",{onClick:B,class:"px-6 py-3 bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"}," Charger plus de critiques ")])):ae("",!0)]),t("div",lt,[t("div",dt,[e[22]||(e[22]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Actions rapides",-1)),t("div",ct,[o(u,{to:"/reviews/create",class:"flex items-center w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"},{default:b(()=>[o(r,{name:"heroicons:plus",class:"w-4 h-4 mr-2"}),e[19]||(e[19]=m(" Nouvelle critique ",-1))]),_:1,__:[19]}),t("button",{onClick:H,class:"flex items-center w-full px-4 py-2 bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"},[o(r,{name:"heroicons:arrow-down-tray",class:"w-4 h-4 mr-2"}),e[20]||(e[20]=m(" Exporter mes critiques ",-1))]),o(u,{to:"/reviews",class:"flex items-center w-full px-4 py-2 bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"},{default:b(()=>[o(r,{name:"heroicons:document-text",class:"w-4 h-4 mr-2"}),e[21]||(e[21]=m(" Toutes les critiques ",-1))]),_:1,__:[21]})])]),t("div",ut,[e[23]||(e[23]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Activité récente",-1)),t("div",gt,[(c(!0),d(P,null,T(n(U),a=>(c(),d("div",{key:a.id,class:"flex items-start space-x-3"},[o(r,{name:a.icon,class:"w-4 h-4 mt-0.5 text-gray-400"},null,8,["name"]),t("div",null,[t("p",mt,i(a.text),1),t("p",pt,i(a.date),1)])]))),128))])]),t("div",xt,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Conseils d'écriture",-1)),t("div",yt,[t("div",bt,[o(r,{name:"heroicons:light-bulb",class:"w-4 h-4 mt-0.5 text-yellow-500"}),e[24]||(e[24]=t("p",null,"Structurez votre critique avec une intro, développement et conclusion",-1))]),t("div",vt,[o(r,{name:"heroicons:light-bulb",class:"w-4 h-4 mt-0.5 text-yellow-500"}),e[25]||(e[25]=t("p",null,"Justifiez votre note avec des arguments concrets",-1))]),t("div",ht,[o(r,{name:"heroicons:light-bulb",class:"w-4 h-4 mt-0.5 text-yellow-500"}),e[26]||(e[26]=t("p",null,"Évitez les spoilers ou utilisez les balises [spoiler]",-1))])])])])])])])}}}),Ct=de(ft,[["__scopeId","data-v-6eef3445"]]);export{Ct as default};
