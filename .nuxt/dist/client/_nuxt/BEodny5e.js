import{j as $,f as D,g as x,h as L,c as i,a as s,b as d,w as I,n as C,k as h,F as k,l as w,t as u,d as M,e as U,o as l,r as B,p as j,_ as E}from"./Bes98wj2.js";const N=()=>{const v=$();return{fetchLatestMessages:async(a={})=>{try{const o=`${v.public.apiBase}/api/forums/messages/latest`,p={limit:a.limit||10,offset:a.offset||0,...a.boardId&&{boardId:a.boardId}};return await $fetch(o,{method:"GET",params:p,headers:{Accept:"application/json","Content-Type":"application/json"}})}catch(o){return console.error("useForumsAPI: Error fetching forum messages:",o),console.error("useForumsAPI: Error details:",{name:o?.name,message:o?.message,status:o?.response?.status,statusText:o?.response?.statusText}),{messages:[],total:0,limit:a.limit||10,offset:a.offset||0}}},fetchBoards:async()=>{try{return await $fetch(`${v.public.apiBase}/api/forums/boards`)||[]}catch(a){return console.error("Error fetching forum boards:",a),[]}},formatMessageTime:a=>{const o=new Date(a*1e3),n=Math.floor((new Date().getTime()-o.getTime())/(1e3*60*60));return n<1?"À l'instant":n<24?`Il y a ${n}h`:n<48?"Hier":o.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})},formatLastActivity:a=>{if(!a)return"";const o=new Date(a*1e3),n=Math.floor((new Date().getTime()-o.getTime())/(1e3*60));if(n<60)return`${n} min`;const _=Math.floor(n/60);return _<24?`${_}h`:`${Math.floor(_/24)}j`},buildForumUrl:(a,o)=>{const n=`${v.public.forumUrl||"http://localhost:8083"}/index.php?topic=${a}`;return o?`${n}.msg${o}#msg${o}`:n}}},R={class:"forum-panel"},S={class:"panel-header"},V={class:"header-content"},H={class:"panel-content"},O={key:0,class:"loading-state"},q={key:1,class:"messages-list"},G=["onClick"],J={class:"message-header"},Q={class:"user-info"},z={class:"user-avatar"},K=["src","alt"],W={key:1,class:"avatar-placeholder"},X={class:"user-details"},Y={class:"user-name"},Z={class:"message-meta"},ee={class:"board-name"},se={class:"message-time"},te={class:"message-stats"},ae={class:"stat-item",title:"Réponses"},oe={class:"message-content"},re={class:"message-title"},ne={class:"message-excerpt"},ie={class:"message-footer"},le={key:0,class:"topic-tags"},ce={class:"last-activity"},de={key:2,class:"error-state"},ue={class:"text-red-600 dark:text-red-400"},me={key:3,class:"empty-state"},pe={class:"panel-footer"},he=D({__name:"ForumPanel",setup(v){const f=x(!0),m=x([]),g=x(""),{fetchLatestMessages:T,formatMessageTime:A,formatLastActivity:a,buildForumUrl:o}=N(),p=async()=>{try{f.value=!0,g.value="",console.log("ForumPanel: Starting to fetch messages...");const r=await T({limit:3});console.log("ForumPanel: Response received:",r),r.messages&&r.messages.length>0?(console.log("ForumPanel: Using real forum data"),m.value=r.messages.map(e=>({id:e.id,topicId:e.topicId,title:n(e.subject),excerpt:_(e.body||"Aucun contenu disponible"),user:{id:e.memberId,name:e.posterName,avatar:void 0},board:e.boardName,timestamp:A(e.posterTime),lastActivity:a(e.lastMessageTime||e.posterTime),replies:e.topicReplies,tags:[]})),console.log("ForumPanel: Transformed messages:",m.value)):(console.log("ForumPanel: No messages from API, using mock data"),F())}catch(r){console.error("ForumPanel: Error loading forum messages:",r),g.value="Erreur lors du chargement des messages",F()}finally{f.value=!1,console.log("ForumPanel: Loading finished, messages count:",m.value.length)}},n=r=>{const e=document.createElement("div");e.innerHTML=r;let c=e.textContent||e.innerText||r;return c=c.replace(/&#33;/g,"!").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#(\d+);/g,(b,t)=>String.fromCharCode(parseInt(t,10))).replace(/&#x([0-9A-Fa-f]+);/g,(b,t)=>String.fromCharCode(parseInt(t,16))),c},_=r=>{const e=n(r);return e.length>150?e.substring(0,150)+"...":e},F=()=>{console.log("ForumPanel: Using mock data as fallback"),m.value=[{id:1,title:"Votre anime préféré de cette saison ?",excerpt:"Salut tout le monde ! Je suis curieux de savoir quels sont vos animes préférés de cette saison d'automne.",user:{id:1,name:"OtakuMaster",avatar:void 0},board:"Discussion générale",timestamp:"Il y a 2h",lastActivity:"1h",replies:23,tags:[]},{id:2,title:"Critique détaillée : Attack on Titan Final",excerpt:"Après avoir terminé la série, je voulais partager mes impressions sur cette conclusion épique.",user:{id:2,name:"CritiqueAnime",avatar:void 0},board:"Critiques",timestamp:"Il y a 3h",lastActivity:"2h",replies:45,tags:[]},{id:3,title:"Où regarder légalement les derniers épisodes ?",excerpt:"Bonjour, je cherche des plateformes légales pour suivre les nouveautés.",user:{id:3,name:"DebutantAnime",avatar:void 0},board:"Aide & Questions",timestamp:"Il y a 4h",lastActivity:"3h",replies:12,tags:[]}]},P=r=>{if(r.topicId){const e=o(r.topicId,r.id);window.open(e,"_blank")}else j("/forums")};return L(async()=>{await p()}),(r,e)=>{const c=B("Icon"),b=U;return l(),i("div",R,[s("div",S,[s("div",V,[d(c,{name:"heroicons:chat-bubble-left-ellipsis",class:"w-6 h-6 text-blue-500"}),e[0]||(e[0]=s("h3",{class:"panel-title"},"Derniers messages",-1))]),d(b,{to:"/forums",class:"panel-link"},{default:I(()=>[e[1]||(e[1]=s("span",null,"Voir tout",-1)),d(c,{name:"heroicons:arrow-right",class:"w-4 h-4"})]),_:1,__:[1]})]),s("div",H,[h(f)?(l(),i("div",O,[(l(),i(k,null,w(3,t=>s("div",{class:"loading-skeleton",key:t})),64))])):(l(),i("div",q,[(l(!0),i(k,null,w(h(m),t=>(l(),i("div",{key:t.id,class:"message-item",onClick:y=>P(t)},[s("div",J,[s("div",Q,[s("div",z,[t.user.avatar?(l(),i("img",{key:0,src:t.user.avatar,alt:t.user.name,class:"avatar-image"},null,8,K)):(l(),i("div",W,u(t.user.name.charAt(0).toUpperCase()),1))]),s("div",X,[s("span",Y,u(t.user.name),1),s("div",Z,[s("span",ee,u(t.board),1),e[2]||(e[2]=s("span",{class:"separator"},"•",-1)),s("time",se,u(t.timestamp),1)])])]),s("div",te,[s("div",ae,[d(c,{name:"heroicons:chat-bubble-oval-left",class:"w-4 h-4"}),s("span",null,u(t.replies),1)])])]),s("div",oe,[s("h4",re,u(t.title),1),s("p",ne,u(t.excerpt),1)]),s("div",ie,[t.tags.length>0?(l(),i("div",le,[(l(!0),i(k,null,w(t.tags,y=>(l(),i("span",{key:y,class:"tag"},u(y),1))),128))])):C("",!0),s("div",ce,[d(c,{name:"heroicons:clock",class:"w-3 h-3"}),s("span",null,u(t.lastActivity),1)])])],8,G))),128))])),h(g)&&!h(f)?(l(),i("div",de,[d(c,{name:"heroicons:exclamation-triangle",class:"w-12 h-12 text-red-400"}),s("p",ue,u(h(g)),1),s("button",{onClick:p,class:"retry-button"},[d(c,{name:"heroicons:arrow-path",class:"w-4 h-4"}),e[3]||(e[3]=M(" Réessayer ",-1))])])):!h(f)&&h(m).length===0?(l(),i("div",me,[d(c,{name:"heroicons:chat-bubble-left-ellipsis",class:"w-12 h-12 text-gray-400"}),e[4]||(e[4]=s("p",null,"Aucun message récent",-1))])):C("",!0)]),s("div",pe,[d(b,{to:"/forums",class:"forum-cta"},{default:I(()=>[d(c,{name:"heroicons:plus",class:"w-4 h-4"}),e[5]||(e[5]=M(" Rejoindre la discussion ",-1))]),_:1,__:[5]})])])}}}),ge=E(he,[["__scopeId","data-v-7a5fe011"]]);export{ge as default};
