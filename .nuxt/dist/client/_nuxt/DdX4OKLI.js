import{g as l,q as z,P as E,j as V,f as R,v as j,H as b,X as F,h as U,G as K,c as u,n as $,k as n,a as t,b as x,t as g,w as I,F as W,l as q,e as G,r as O,o as d,d as P,u as X,_ as J}from"./CCeOfYC8.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        */import{u as Q}from"./Hes4McSu.js";function B(s){if(!s)return"";const o=s.match(/webzine\/img\/([^\/\?]+)/);return o&&o[1]?`/api/webzine/img/${o[1]}`:s}function D(s){return s?s.replace(/(src=["']?)([^"'\s]*webzine\/img\/[^"'\s]*)(["']?)/gi,(o,p,e,y)=>{const f=B(e);return`${p}${f}${y}`}):""}function Y(){const s=l(!1),o=l(null),p=z(),e=V(),y=async i=>{s.value=!0,o.value=null;try{return await $fetch(`${e.public.apiBase}/api/articles/${i}/comments`)}catch(c){throw o.value="Erreur lors du chargement des commentaires",console.error("Comments API Error:",c),c}finally{s.value=!1}},f=async(i,c)=>{s.value=!0,o.value=null;try{return await $fetch(`${e.public.apiBase}/api/articles/${i}/comments`,{method:"POST",body:{commentaire:c,id_article:i},headers:p.getAuthHeaders()})}catch(m){throw o.value="Erreur lors de la création du commentaire",console.error("Create comment API Error:",m),m}finally{s.value=!1}},_=async(i,c)=>{s.value=!0,o.value=null;try{return await $fetch(`${e.public.apiBase}/api/comments/${i}`,{method:"PUT",body:{commentaire:c},headers:p.getAuthHeaders()})}catch(m){throw o.value="Erreur lors de la mise à jour du commentaire",console.error("Update comment API Error:",m),m}finally{s.value=!1}},v=async i=>{s.value=!0,o.value=null;try{await $fetch(`${e.public.apiBase}/api/comments/${i}`,{method:"DELETE",headers:p.getAuthHeaders()})}catch(c){throw o.value="Erreur lors de la suppression du commentaire",console.error("Delete comment API Error:",c),c}finally{s.value=!1}};return{loading:E(s),error:E(o),fetchComments:y,createComment:f,updateComment:_,deleteComment:v}}const Z={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},ee={key:0,class:"flex items-center justify-center py-12"},te={key:1,class:"container mx-auto px-4 py-8"},re={class:"rounded-md bg-red-50 dark:bg-red-900/20 p-4"},ae={class:"flex"},ne={class:"ml-3"},se={class:"mt-2 text-sm text-red-700 dark:text-red-300"},oe={class:"mt-4 space-x-3"},le={key:2,class:"container mx-auto px-4 py-8"},ie={class:"max-w-4xl mx-auto"},ce={class:"text-4xl font-bold mb-4"},ue={class:"text-gray-600 mb-4"},de={key:0,class:"mb-6"},me=["src","alt"],ge=["innerHTML"],pe=["innerHTML"],fe={key:3,class:"text-gray-500"},he={class:"mt-16 pt-8 border-t border-gray-200 dark:border-gray-700"},ve={class:"mb-8"},ye={class:"text-2xl font-bold text-gray-900 dark:text-white mb-4"},_e={class:"mb-8 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700"},xe={key:0,class:"space-y-4"},be={class:"flex items-start space-x-3"},we={class:"w-8 h-8 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0"},ke={class:"flex-1 min-w-0"},Ae={class:"flex items-center space-x-2 mb-2"},Ce={class:"text-sm font-medium text-gray-900 dark:text-white"},Ee={class:"text-xs text-gray-500 dark:text-gray-400"},$e={class:"text-gray-700 dark:text-gray-300 text-sm leading-relaxed"},Ie={key:1,class:"text-center py-8"},Pe=R({__name:"[slug]",setup(s){const o=j(),p=o.params.slug,e=l(null);l(null),l(null);const y=l([]),f=l([]),_=l(!0),v=l("");l(!0),l(!1),l(!1),l(null),l(""),l(!1),z();const i=Q(),c=Y(),m=b(()=>e.value?window.location.href:"");b(()=>{if(!e.value?.contenu)return 0;const r=200,a=e.value.contenu.split(" ").length;return Math.ceil(a/r)});const H=b(()=>e.value?.content?D(e.value.content):""),N=b(()=>e.value?.contenu?D(e.value.contenu):""),w=async()=>{try{_.value=!0,v.value="";const r=await i.fetchArticleBySlug(p);e.value=r,r.idArt&&await i.trackArticleView(r.idArt),await Promise.allSettled([L(),M(),T()])}catch(r){v.value="Article non trouvé",console.error("Error loading article:",r)}finally{_.value=!1}},L=async()=>{if(e.value)try{const r=await c.fetchComments(e.value.idArt);f.value=r}catch(r){console.error("Error loading comments:",r)}},M=async()=>{if(e.value)try{if(e.value.categories&&e.value.categories.length>0){const r=await i.fetchArticlesByCategory(e.value.categories[0].id,{limit:4});y.value=r.articles.filter(a=>a.idArt!==e.value.idArt)}}catch(r){console.error("Error loading related articles:",r)}},T=async()=>{},A=r=>r?new Date(r).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",S=r=>{const a=r.target;console.warn("Failed to load image:",a.src),a.style.display="none"};return F(()=>{e.value&&X({title:`${e.value.titre} - Anime-Kun V2`,meta:[{name:"description",content:e.value.metaDescription||`Découvrez l'article "${e.value.titre}" sur Anime-Kun V2`},{name:"keywords",content:e.value.tags||"article, anime, manga"},{property:"og:title",content:e.value.titre},{property:"og:description",content:e.value.metaDescription||""},{property:"og:image",content:e.value.imgunebig||e.value.img||""},{property:"og:type",content:"article"},{property:"og:url",content:m.value},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:e.value.titre},{name:"twitter:description",content:e.value.metaDescription||""},{name:"twitter:image",content:e.value.imgunebig||e.value.img||""}],link:[{rel:"canonical",href:m.value}]})}),U(()=>{w()}),K(()=>o.params.slug,r=>{r&&r!==p&&w()}),(r,a)=>{const k=O("Icon"),C=G;return d(),u("div",Z,[n(_)?(d(),u("div",ee,a[0]||(a[0]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent"},null,-1),t("span",{class:"ml-3 text-gray-600 dark:text-gray-300"},"Chargement de l'article...",-1)]))):n(v)?(d(),u("div",te,[t("div",re,[t("div",ae,[x(k,{name:"heroicons:exclamation-triangle",class:"h-5 w-5 text-red-400"}),t("div",ne,[a[2]||(a[2]=t("h3",{class:"text-sm font-medium text-red-800 dark:text-red-200"}," Article non trouvé ",-1)),t("div",se,g(n(v)),1),t("div",oe,[x(C,{to:"/articles",class:"btn-primary"},{default:I(()=>a[1]||(a[1]=[P(" Retour aux articles ",-1)])),_:1,__:[1]}),t("button",{onClick:w,class:"btn-secondary"}," Réessayer ")])])])])])):n(e)?(d(),u("div",le,[t("div",ie,[t("h1",ce,g(n(e).titre),1),t("div",ue,[t("p",null,"Publié le "+g(A(n(e).date))+" par "+g(n(e).author?.memberName||"Inconnu")+" dans "+g(n(e).categories?.map(h=>h.nom||h.name).join(", ")||"Aucune catégorie")+" - "+g(n(f).length)+" commentaires",1)]),n(e).imgunebig||n(e).img?(d(),u("div",de,[t("img",{src:n(B)(n(e).imgunebig||n(e).img),alt:n(e).titre,class:"w-full max-w-2xl mx-auto rounded-lg shadow-lg",onError:S},null,40,me)])):$("",!0),n(e).content?(d(),u("div",{key:1,class:"prose max-w-none",innerHTML:n(H)},null,8,ge)):n(e).contenu?(d(),u("div",{key:2,class:"prose max-w-none",innerHTML:n(N)},null,8,pe)):(d(),u("div",fe,"No content available")),t("section",he,[t("div",ve,[t("h2",ye," Commentaires ("+g(n(f).length)+") ",1),t("div",_e,[a[4]||(a[4]=t("p",{class:"text-blue-800 dark:text-blue-200 mb-3"}," Connectez-vous pour laisser un commentaire ",-1)),x(C,{to:"/login",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"},{default:I(()=>a[3]||(a[3]=[P(" Se connecter ",-1)])),_:1,__:[3]})])]),n(f).length>0?(d(),u("div",xe,[(d(!0),u(W,null,q(n(f),h=>(d(),u("div",{key:h.id,class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},[t("div",be,[t("div",we,[x(k,{name:"heroicons:user",class:"w-4 h-4 text-gray-500 dark:text-gray-400"})]),t("div",ke,[t("div",Ae,[t("span",Ce,g(h.author?.memberName||h.nom),1),t("span",Ee,g(A(h.date)),1)]),t("p",$e,g(h.commentaire),1)])])]))),128))])):(d(),u("div",Ie,[x(k,{name:"heroicons:chat-bubble-left",class:"mx-auto h-12 w-12 text-gray-400"}),a[5]||(a[5]=t("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"}," Aucun commentaire ",-1)),a[6]||(a[6]=t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Soyez le premier à commenter cet article. ",-1))]))])])])):$("",!0)])}}}),Me=J(Pe,[["__scopeId","data-v-30d7c890"]]);export{Me as default};
