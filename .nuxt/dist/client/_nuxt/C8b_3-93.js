import{f as ne,v as le,q as oe,g as b,x as D,h as ie,u as re,c as r,a as s,b as d,w as E,d as p,n as A,k as a,t as c,y as de,z as f,A as v,K as O,m as z,F as M,l as V,J,j as ue,e as me,r as ce,o as i,_ as pe}from"./Bes98wj2.js";import{u as ge}from"./mNEXZuPr.js";import{u as K}from"./DKV7c2p8.js";const fe={class:"admin-layout"},be={class:"admin-sidebar"},ve={class:"sidebar-section"},ye={class:"sidebar-section"},he={class:"sidebar-section"},we={class:"quick-links"},xe={href:"http://localhost:3003/docs",target:"_blank",class:"quick-link"},ke={class:"admin-main"},_e={key:0,class:"card p-6 text-center"},$e={key:1,class:"card p-6 text-center text-red-600"},Ae={key:2,class:"space-y-6"},Ee={class:"section-header"},Ce={class:"section-title"},Be={class:"text-gray-600 mt-1"},Te={class:"flex gap-3"},je={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ie={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ve={key:0,class:"mt-2 text-sm text-gray-600"},Se={class:"flex justify-end gap-3 pt-4 border-t"},qe=["disabled"],He={class:"card p-6 space-y-4"},Re={class:"bg-gray-50 p-4 rounded-lg"},Ue={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},De={key:0,class:"space-y-2"},Ne={class:"space-y-2"},Fe={class:"font-medium"},Pe={class:"text-sm text-gray-600 ml-2"},Le=["onClick"],Oe={class:"card p-6 space-y-4"},ze={class:"bg-gray-50 p-4 rounded-lg"},Je={class:"space-y-3"},Ke={key:0,class:"space-y-1 max-h-32 overflow-y-auto"},Qe=["onClick"],Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},We={key:0,class:"space-y-2"},Xe={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ye={class:"font-medium"},Ze={class:"text-sm text-gray-600"},es=["onClick"],ss={class:"card p-6 space-y-4"},ts={class:"bg-gray-50 p-4 rounded-lg"},as={class:"space-y-3"},ns={key:0,class:"flex flex-wrap gap-2"},ls=["onClick"],os={key:0,class:"space-y-2"},is={class:"flex flex-wrap gap-2"},rs=["onClick"],ds=ne({__name:"[id]",setup(us){const N=le(),u=ue(),m=oe(),{success:h,error:y}=ge(),l=b(null),H=b(!1),S=b(null),C=b(!1),R=b([]),U=b([]),B=b([]),w=D({related_type:"anime",related_id:void 0,relation_type:"related"}),x=b(""),T=b([]),k=D({businessId:void 0,role:""}),_=b(""),j=b([]),I=D({tagId:void 0}),F=async()=>{try{H.value=!0,S.value=null;const n=await $fetch(`${u.public.apiBase}/api/admin/mangas/${N.params.id}`,{headers:m.getAuthHeaders()});l.value=n,await $()}catch(n){S.value=n?.data?.message||"Erreur lors du chargement du manga",console.error("Error loading manga:",n)}finally{H.value=!1}},Q=async()=>{try{C.value=!0;const n={titre:l.value.titre,auteur:l.value.auteur,annee:l.value.annee,nbVol:l.value.nbVol,editeur:l.value.editeur,synopsis:l.value.synopsis,image:l.value.image,statut:l.value.statut};await $fetch(`${u.public.apiBase}/api/admin/mangas/${l.value.idManga}`,{method:"PUT",headers:{"Content-Type":"application/json",...m.getAuthHeaders()},body:n}),h("Manga mis à jour avec succès")}catch(n){console.error("Error saving manga:",n),y(n?.data?.message||"Erreur lors de l'enregistrement")}finally{C.value=!1}},G=async n=>{const e=n.target.files;if(!e||!e[0])return;const o=new FormData;o.append("file",e[0]),o.append("type","manga"),o.append("relatedId",String(l.value.idManga));try{const g=await $fetch(`${u.public.apiBase}/api/media/upload`,{method:"POST",body:o,headers:m.getAuthHeaders()});l.value.image=g.filename,h("Image uploadée avec succès")}catch(g){console.error("Upload error",g),y("Échec de l'upload de l'image")}},$=async()=>{if(l.value)try{const n="manga",[e,o,g]=await Promise.all([$fetch(`${u.public.apiBase}/api/admin/content/${n}/${l.value.idManga}/relationships`,{headers:m.getAuthHeaders()}),$fetch(`${u.public.apiBase}/api/admin/content/${n}/${l.value.idManga}/staff`,{headers:m.getAuthHeaders()}),$fetch(`${u.public.apiBase}/api/admin/content/${n}/${l.value.idManga}/tags`,{headers:m.getAuthHeaders()})]);R.value=e,U.value=o,B.value=g}catch(n){console.error("Error loading admin extras:",n)}},W=async()=>{if(w.related_id)try{await $fetch(`${u.public.apiBase}/api/admin/content/manga/${l.value.idManga}/relationships`,{method:"POST",headers:{"Content-Type":"application/json",...m.getAuthHeaders()},body:w}),w.related_id=void 0,await $(),h("Relation ajoutée")}catch{y("Erreur lors de l'ajout de la relation")}},X=async n=>{try{await $fetch(`${u.public.apiBase}/api/admin/content/relationships/${n.id_relation}`,{method:"DELETE",headers:m.getAuthHeaders()}),await $(),h("Relation supprimée")}catch{y("Erreur lors de la suppression")}},P=K(async()=>{if(!x.value){T.value=[];return}try{const n=await $fetch(`${u.public.apiBase}/api/admin/business`,{params:{search:x.value,page:1,limit:10},headers:m.getAuthHeaders()});T.value=n.items||[]}catch(n){console.error("Error searching business:",n)}},400),Y=n=>{k.businessId=n.idBusiness,x.value=n.nom,T.value=[]},Z=async()=>{if(k.businessId)try{await $fetch(`${u.public.apiBase}/api/admin/content/manga/${l.value.idManga}/staff`,{method:"POST",headers:{"Content-Type":"application/json",...m.getAuthHeaders()},body:k}),k.businessId=void 0,k.role="",x.value="",await $(),h("Membre ajouté à l'équipe")}catch{y("Erreur lors de l'ajout du membre")}},ee=async n=>{const e=n.id_business||n.idBusiness;try{await $fetch(`${u.public.apiBase}/api/admin/content/manga/${l.value.idManga}/staff/${e}`,{method:"DELETE",headers:m.getAuthHeaders()}),await $(),h("Membre retiré de l'équipe")}catch{y("Erreur lors de la suppression")}},L=K(async()=>{if(!_.value){j.value=[];return}try{const n=await $fetch(`${u.public.apiBase}/api/admin/content/tags/search`,{params:{q:_.value,limit:10},headers:m.getAuthHeaders()}),e=new Set(B.value.map(o=>o.id));j.value=(n.items||[]).filter(o=>!e.has(o.id))}catch(n){console.error("Error searching tags:",n)}},300),se=n=>{I.tagId=n.id,_.value=n.name},te=async()=>{if(I.tagId){if(B.value.some(n=>n.id===I.tagId)){y("Ce tag est déjà associé");return}try{await $fetch(`${u.public.apiBase}/api/admin/content/manga/${l.value.idManga}/tags`,{method:"POST",headers:{"Content-Type":"application/json",...m.getAuthHeaders()},body:I}),I.tagId=void 0,_.value="",j.value=[],await $(),h("Tag ajouté")}catch{y("Erreur lors de l'ajout du tag")}}},ae=async n=>{try{await $fetch(`${u.public.apiBase}/api/admin/content/manga/${l.value.idManga}/tags/${n.id}`,{method:"DELETE",headers:m.getAuthHeaders()}),await $(),h("Tag retiré")}catch{y("Erreur lors de la suppression")}};return ie(()=>{F()}),re({title:`Admin - Manga #${N.params.id}`}),(n,e)=>{const o=ce("Icon"),g=me;return i(),r("div",fe,[s("aside",be,[s("div",ve,[e[15]||(e[15]=s("h3",{class:"sidebar-title"},"Navigation",-1)),d(g,{to:"/admin",class:"sidebar-link"},{default:E(()=>[d(o,{name:"heroicons:home",class:"w-4 h-4"}),e[14]||(e[14]=p(" Dashboard ",-1))]),_:1,__:[14]})]),s("div",ye,[e[19]||(e[19]=s("h3",{class:"sidebar-title"},"Contenu",-1)),d(g,{to:"/admin/animes",class:"sidebar-link"},{default:E(()=>[d(o,{name:"heroicons:film",class:"w-4 h-4"}),e[16]||(e[16]=p(" Animes ",-1))]),_:1,__:[16]}),d(g,{to:"/admin/mangas",class:"sidebar-link active"},{default:E(()=>[d(o,{name:"heroicons:book-open",class:"w-4 h-4"}),e[17]||(e[17]=p(" Mangas ",-1))]),_:1,__:[17]}),d(g,{to:"/admin/business",class:"sidebar-link"},{default:E(()=>[d(o,{name:"heroicons:building-office",class:"w-4 h-4"}),e[18]||(e[18]=p(" Entreprises ",-1))]),_:1,__:[18]})]),s("div",he,[e[25]||(e[25]=s("h3",{class:"sidebar-title"},"Liens Rapides",-1)),s("div",we,[e[21]||(e[21]=s("a",{href:"/admin/mangas",class:"quick-link"},"/admin/mangas",-1)),e[22]||(e[22]=s("a",{href:"/admin/mangas/create",class:"quick-link"},"/admin/mangas/create",-1)),e[23]||(e[23]=s("a",{href:"/admin/animes",class:"quick-link"},"/admin/animes",-1)),e[24]||(e[24]=s("a",{href:"/admin/business",class:"quick-link"},"/admin/business",-1)),s("a",xe,[e[20]||(e[20]=p(" API Docs ",-1)),d(o,{name:"heroicons:arrow-top-right-on-square",class:"w-3 h-3 ml-1"})])])])]),s("main",ke,[a(H)?(i(),r("div",_e,e[26]||(e[26]=[s("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1),s("p",{class:"mt-2 text-gray-600"},"Chargement du manga...",-1)]))):a(S)?(i(),r("div",$e,[s("p",null,c(a(S)),1),s("button",{class:"btn-secondary mt-4",onClick:F},"Réessayer")])):a(l)?(i(),r("div",Ae,[s("div",Ee,[s("div",null,[s("h1",Ce,"Éditer le manga #"+c(a(l).idManga),1),s("p",Be,c(a(l).titre),1)]),s("div",Te,[d(g,{to:"/admin/mangas",class:"btn-secondary"},{default:E(()=>[d(o,{name:"heroicons:arrow-left",class:"w-4 h-4 mr-2"}),e[27]||(e[27]=p(" Retour ",-1))]),_:1,__:[27]})])]),s("form",{onSubmit:de(Q,["prevent"]),class:"card p-6 space-y-6"},[e[38]||(e[38]=s("h2",{class:"text-lg font-semibold text-gray-900 border-b pb-2"},"Informations principales",-1)),s("div",null,[e[28]||(e[28]=s("label",{class:"form-label"},"Titre *",-1)),f(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>a(l).titre=t),class:"form-input w-full",required:""},null,512),[[v,a(l).titre]])]),s("div",je,[s("div",null,[e[29]||(e[29]=s("label",{class:"form-label"},"Auteur",-1)),f(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>a(l).auteur=t),class:"form-input w-full",placeholder:"Nom de l'auteur"},null,512),[[v,a(l).auteur]])]),s("div",null,[e[30]||(e[30]=s("label",{class:"form-label"},"Année",-1)),f(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>a(l).annee=t),class:"form-input w-full",placeholder:"2024",maxlength:"4"},null,512),[[v,a(l).annee]])])]),s("div",Ie,[s("div",null,[e[31]||(e[31]=s("label",{class:"form-label"},"Éditeur",-1)),f(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>a(l).editeur=t),class:"form-input w-full",placeholder:"Nom de l'éditeur"},null,512),[[v,a(l).editeur]])]),s("div",null,[e[32]||(e[32]=s("label",{class:"form-label"},"Nombre de volumes",-1)),f(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>a(l).nbVol=t),type:"number",min:"0",class:"form-input w-full",placeholder:"0"},null,512),[[v,a(l).nbVol,void 0,{number:!0}]])])]),s("div",null,[e[33]||(e[33]=s("label",{class:"form-label"},"Synopsis",-1)),f(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=t=>a(l).synopsis=t),rows:"4",class:"form-input w-full",placeholder:"Description du manga..."},null,512),[[v,a(l).synopsis]])]),s("div",Me,[s("div",null,[e[35]||(e[35]=s("label",{class:"form-label"},"Statut de publication",-1)),f(s("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>a(l).statut=t),class:"form-input w-full"},e[34]||(e[34]=[s("option",{value:1},"Affichée",-1),s("option",{value:2},"En attente",-1),s("option",{value:0},"Bloquée",-1)]),512),[[O,a(l).statut,void 0,{number:!0}]])]),s("div",null,[e[36]||(e[36]=s("label",{class:"form-label"},"Image de couverture",-1)),s("input",{type:"file",accept:"image/*",onChange:G,class:"form-input w-full"},null,32),a(l).image?(i(),r("div",Ve,[d(o,{name:"heroicons:photo",class:"w-4 h-4 inline mr-1"}),p(" "+c(a(l).image),1)])):A("",!0)])]),s("div",Se,[d(g,{to:"/admin/mangas",class:"btn-secondary"},{default:E(()=>e[37]||(e[37]=[p("Annuler",-1)])),_:1,__:[37]}),s("button",{type:"submit",class:"btn-primary",disabled:a(C)},[a(C)?(i(),z(o,{key:0,name:"heroicons:arrow-path",class:"w-4 h-4 mr-2 animate-spin"})):(i(),z(o,{key:1,name:"heroicons:check",class:"w-4 h-4 mr-2"})),p(" "+c(a(C)?"Enregistrement...":"Enregistrer"),1)],8,qe)])],32),s("div",He,[e[43]||(e[43]=s("h2",{class:"text-lg font-semibold text-gray-900 border-b pb-2"},"Relations",-1)),s("div",Re,[e[41]||(e[41]=s("h3",{class:"font-medium text-gray-900 mb-3"},"Ajouter une relation",-1)),s("div",Ue,[f(s("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>a(w).related_type=t),class:"form-input"},e[39]||(e[39]=[s("option",{value:"anime"},"Anime",-1),s("option",{value:"manga"},"Manga",-1)]),512),[[O,a(w).related_type]]),f(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a(w).related_id=t),type:"number",placeholder:"ID de l'élément",class:"form-input"},null,512),[[v,a(w).related_id,void 0,{number:!0}]]),s("button",{onClick:W,type:"button",class:"btn-secondary"},[d(o,{name:"heroicons:plus",class:"w-4 h-4 mr-2"}),e[40]||(e[40]=p(" Ajouter ",-1))])])]),a(R).length>0?(i(),r("div",De,[e[42]||(e[42]=s("h3",{class:"font-medium text-gray-900"},"Relations existantes",-1)),s("div",Ne,[(i(!0),r(M,null,V(a(R),t=>(i(),r("div",{key:t.id_relation,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[s("div",null,[s("span",Fe,c(t.related_type),1),p(" #"+c(t.related_id)+" ",1),s("span",Pe,"("+c(t.relation_type)+")",1)]),s("button",{onClick:q=>X(t),class:"btn-small danger"},[d(o,{name:"heroicons:trash",class:"w-4 h-4"})],8,Le)]))),128))])])):A("",!0)]),s("div",Oe,[e[47]||(e[47]=s("h2",{class:"text-lg font-semibold text-gray-900 border-b pb-2"},"Staff & Équipe",-1)),s("div",ze,[e[45]||(e[45]=s("h3",{class:"font-medium text-gray-900 mb-3"},"Ajouter un membre",-1)),s("div",Je,[f(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>J(x)?x.value=t:null),onInput:e[10]||(e[10]=(...t)=>a(P)&&a(P)(...t)),placeholder:"Rechercher une entreprise...",class:"form-input w-full"},null,544),[[v,a(x)]]),a(T).length>0?(i(),r("div",Ke,[(i(!0),r(M,null,V(a(T),t=>(i(),r("button",{key:t.idBusiness,onClick:q=>Y(t),type:"button",class:"w-full text-left p-2 hover:bg-gray-100 rounded"},c(t.nom)+" (ID: "+c(t.idBusiness)+") ",9,Qe))),128))])):A("",!0),s("div",Ge,[f(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>a(k).role=t),placeholder:"Rôle (ex: Auteur, Éditeur...)",class:"form-input"},null,512),[[v,a(k).role]]),s("button",{onClick:Z,type:"button",class:"btn-secondary"},[d(o,{name:"heroicons:user-plus",class:"w-4 h-4 mr-2"}),e[44]||(e[44]=p(" Ajouter au staff ",-1))])])])]),a(U).length>0?(i(),r("div",We,[e[46]||(e[46]=s("h3",{class:"font-medium text-gray-900"},"Équipe actuelle",-1)),s("div",Xe,[(i(!0),r(M,null,V(a(U),t=>(i(),r("div",{key:t.idBusiness||t.id_business,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[s("div",null,[s("div",Ye,c(t.nom||t.business?.nom),1),s("div",Ze,c(t.role),1)]),s("button",{onClick:q=>ee(t),class:"btn-small danger"},[d(o,{name:"heroicons:trash",class:"w-4 h-4"})],8,es)]))),128))])])):A("",!0)]),s("div",ss,[e[51]||(e[51]=s("h2",{class:"text-lg font-semibold text-gray-900 border-b pb-2"},"Tags & Catégories",-1)),s("div",ts,[e[49]||(e[49]=s("h3",{class:"font-medium text-gray-900 mb-3"},"Ajouter un tag",-1)),s("div",as,[f(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>J(_)?_.value=t:null),onInput:e[13]||(e[13]=(...t)=>a(L)&&a(L)(...t)),placeholder:"Rechercher un tag...",class:"form-input w-full"},null,544),[[v,a(_)]]),a(j).length>0?(i(),r("div",ns,[(i(!0),r(M,null,V(a(j),t=>(i(),r("button",{key:t.id,onClick:q=>se(t),type:"button",class:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm hover:bg-blue-200"},c(t.name),9,ls))),128))])):A("",!0),s("button",{onClick:te,type:"button",class:"btn-secondary"},[d(o,{name:"heroicons:tag",class:"w-4 h-4 mr-2"}),e[48]||(e[48]=p(" Ajouter le tag ",-1))])])]),a(B).length>0?(i(),r("div",os,[e[50]||(e[50]=s("h3",{class:"font-medium text-gray-900"},"Tags actuels",-1)),s("div",is,[(i(!0),r(M,null,V(a(B),t=>(i(),r("div",{key:t.id,class:"flex items-center gap-2 px-3 py-1 bg-gray-100 rounded-full text-sm"},[s("span",null,c(t.name),1),s("button",{onClick:q=>ae(t),class:"text-red-600 hover:text-red-800"},[d(o,{name:"heroicons:x-mark",class:"w-3 h-3"})],8,rs)]))),128))])])):A("",!0)])])):A("",!0)])])}}}),gs=pe(ds,[["__scopeId","data-v-4775d62f"]]);export{gs as default};
