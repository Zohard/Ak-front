import{f as H,u as G,g as m,x as J,H as B,h as L,G as A,c,a as s,b as u,d as b,t as f,k as n,n as I,F as N,l as V,z as W,K as X,J as Y,j as Z,r as Q,o as l,m as ee,B as te,v as se,_ as ae}from"./CCeOfYC8.js";import oe from"./BkLFQHtC.js";import ie from"./CntGVgX6.js";import ne from"./DVDIefje.js";import{u as re}from"./C_YtV1it.js";import{u as le,a as de}from"./SwZ-OZp_.js";import"./BYwTe9_t.js";import"./B3ebZBhz.js";import"./B9jFdIe5.js";const ce={class:"reviews-page"},me={class:"hero-section bg-gradient-to-r from-blue-600 to-purple-600 text-white py-16"},ue={class:"container mx-auto px-4"},pe={class:"text-center"},ge={class:"text-4xl md:text-5xl font-bold mb-4 flex items-center justify-center gap-4"},ve={class:"flex flex-wrap justify-center gap-4 text-sm md:text-base"},fe={class:"bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2"},he={class:"font-semibold"},xe={class:"container mx-auto px-4 py-8"},be={class:"mb-8"},ye={class:"mb-8"},_e={key:0,class:"flex items-center justify-center py-12"},ke={key:1,class:"rounded-md bg-red-50 dark:bg-red-900/20 p-4 mb-8"},Ce={class:"flex"},we={class:"ml-3"},qe={class:"mt-2 text-sm text-red-700 dark:text-red-300"},Pe={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Re={key:3,class:"text-center py-12"},Me={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},Be={key:0,class:"mt-6"},Ae={key:4,class:"mt-8 flex items-center justify-between"},Ie={class:"flex items-center space-x-2"},Ne={class:"text-sm text-gray-700 dark:text-gray-300"},Ve={class:"flex items-center space-x-2"},ze=["disabled"],Fe={class:"flex items-center space-x-1"},Ee=["onClick"],Oe=["disabled"],$e=H({__name:"all",setup(je){G({title:"Critiques - Anime-Kun",meta:[{name:"description",content:"Découvrez les critiques d'animes et mangas de la communauté Anime-Kun"}]});const y=m([]),_=m(!0),x=m(""),p=m(0),k=m(0),r=m(1),g=m(1),h=m(12),o=J({search:"",type:"",minNotation:"",sortBy:"dateCritique",sortOrder:!1,author:"",dateRange:"",minViews:""}),w=B(()=>o.search||o.type||o.minNotation||o.sortBy!=="dateCritique"||o.author||o.dateRange||o.minViews),z=B(()=>{const a=[],e=Math.max(1,r.value-2),d=Math.min(g.value,r.value+2);for(let i=e;i<=d;i++)a.push(i);return a}),q=re(),v=async()=>{try{_.value=!0,x.value="";const a={page:r.value,limit:h.value,search:o.search||void 0,minNotation:o.minNotation?parseInt(o.minNotation):void 0,sortBy:o.sortBy,sortOrder:o.sortOrder?"desc":"asc"};(o.type==="anime"||o.type==="manga")&&(a.type=o.type);const e=await q.fetchReviews(a),d=e.reviews||e.data||[];let i=d.map(t=>({idCritique:t.id,niceUrl:t.niceUrl,titre:t.titre,critique:t.critique,notation:t.notation,dateCritique:t.reviewDate,statut:t.statut||1,idMembre:t.userId,idAnime:t.animeId,idManga:t.mangaId,nbClics:t.nbClics||0,anime:t.anime?{id:t.anime.id,titre:t.anime.titre,image:t.anime.image}:void 0,manga:t.manga?{id:t.manga.id,titre:t.manga.titre,image:t.manga.image}:void 0,membre:t.membre?{id:t.membre.id||t.membre.idMember,pseudo:t.membre.pseudo||t.membre.memberName,avatar:t.membre.avatar}:void 0}));o.type==="anime"?i=i.filter(t=>!t.idManga||t.idManga===0):o.type==="manga"&&(i=i.filter(t=>t.idManga&&t.idManga>0)),y.value=i,k.value=e.pagination?.total||e.meta?.total||d.length,g.value=e.pagination?.totalPages||e.meta?.totalPages||Math.ceil(k.value/h.value)}catch{x.value=q.error.value||"Erreur lors du chargement des critiques"}finally{_.value=!1}},F=Z(),E=async()=>{try{const a=await $fetch(`${F.public.apiBase}/api/reviews/count`);p.value=a?.count||0}catch(a){console.error("Error loading stats:",a),p.value=0}},P=()=>{r.value=1,v()},O=a=>{Object.assign(o,a),P()},R=()=>{Object.assign(o,{search:"",type:"",minNotation:"",sortBy:"dateCritique",sortOrder:!1,author:"",dateRange:"",minViews:""}),P()},C=a=>{a>=1&&a<=g.value&&(r.value=a,v(),window.scrollTo({top:0,behavior:"smooth"}))},$=()=>{r.value=1,v()},j=(a,e)=>{console.log(`Review ${a} ${e?"added to":"removed from"} favorites`)},S=a=>{console.log("Viewing review:",a.titre)},{setPageSEO:D,addBreadcrumbStructuredData:T}=le(),M=()=>{const a=p.value>0?` - ${p.value} critiques`:"";D({title:`Critiques d'animes et mangas${a}`,description:"Découvrez les dernières critiques d'animes et mangas de la communauté AK9. Partagez votre avis, trouvez votre prochain anime à regarder et rejoignez notre communauté passionnée.",keywords:["critiques anime","critiques manga","reviews anime","reviews manga","communauté anime","recommandations anime","recommandations manga","otaku","anime français"],type:"website"}),T([{name:"Accueil",url:"/"},{name:"Critiques",url:"/reviews"}])},{monitorPerformance:K,optimizeForConnection:U}=de();return U(),L(()=>{E(),v(),M(),K()}),A(()=>se().query,a=>{a.page&&(r.value=parseInt(a.page)||1),a.search&&(o.search=a.search),v()},{immediate:!1}),A([p],()=>{M()}),(a,e)=>{const d=Q("Icon");return l(),c("div",ce,[s("div",me,[s("div",ue,[s("div",pe,[s("h1",ge,[u(d,{name:"heroicons:star",class:"w-12 h-12 text-yellow-300"}),e[3]||(e[3]=b(" Critiques d'Animes et Mangas ",-1))]),e[5]||(e[5]=s("p",{class:"text-xl md:text-2xl mb-6 opacity-90"}," Découvrez les avis de la communauté sur vos œuvres préférées ",-1)),s("div",ve,[s("div",fe,[s("span",he,f(n(p)),1),e[4]||(e[4]=b(" critiques ",-1))])])])])]),s("div",xe,[s("div",be,[u(ne,{limit:6,"default-type":"both"})]),s("div",ye,[u(oe,{filters:n(o),"results-count":n(k),"search-placeholder":"Titre, contenu, anime, manga...","onUpdate:filters":O,onClear:R},null,8,["filters","results-count"])]),n(_)?(l(),c("div",_e,e[6]||(e[6]=[s("div",{class:"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent"},null,-1),s("span",{class:"ml-3 text-gray-600 dark:text-gray-300"},"Chargement des critiques...",-1)]))):n(x)?(l(),c("div",ke,[s("div",Ce,[u(d,{name:"heroicons:exclamation-triangle",class:"h-5 w-5 text-red-400"}),s("div",we,[e[7]||(e[7]=s("h3",{class:"text-sm font-medium text-red-800 dark:text-red-200"}," Erreur de chargement ",-1)),s("div",qe,f(n(x)),1),s("div",{class:"mt-4"},[s("button",{onClick:v,class:"btn-primary"}," Réessayer ")])])])])):n(y).length?(l(),c("div",Pe,[(l(!0),c(N,null,V(n(y),i=>(l(),ee(ie,{key:i.idCritique,review:i,onFavorite:j,onView:S},null,8,["review"]))),128))])):(l(),c("div",Re,[u(d,{name:"heroicons:document-text",class:"mx-auto h-12 w-12 text-gray-400"}),e[8]||(e[8]=s("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"}," Aucune critique trouvée ",-1)),s("p",Me,f(n(w)?"Essayez de modifier vos filtres.":"Aucune critique disponible pour le moment."),1),n(w)?(l(),c("div",Be,[s("button",{onClick:R,class:"btn-primary"}," Effacer les filtres ")])):I("",!0)])),n(g)>1?(l(),c("div",Ae,[s("div",Ie,[s("span",Ne," Page "+f(n(r))+" sur "+f(n(g)),1),W(s("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>Y(h)?h.value=i:null),class:"form-input w-auto",onChange:$},e[9]||(e[9]=[s("option",{value:"12"},"12 par page",-1),s("option",{value:"24"},"24 par page",-1),s("option",{value:"48"},"48 par page",-1)]),544),[[X,n(h)]])]),s("div",Ve,[s("button",{disabled:n(r)===1,onClick:e[1]||(e[1]=i=>C(n(r)-1)),class:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed"},[u(d,{name:"heroicons:chevron-left",class:"w-4 h-4"}),e[10]||(e[10]=b(" Précédent ",-1))],8,ze),s("div",Fe,[(l(!0),c(N,null,V(n(z),i=>(l(),c("button",{key:i,class:te(["px-3 py-2 text-sm rounded-md transition-colors",i===n(r)?"bg-blue-600 text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"]),onClick:t=>C(i)},f(i),11,Ee))),128))]),s("button",{disabled:n(r)===n(g),onClick:e[2]||(e[2]=i=>C(n(r)+1)),class:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed"},[e[11]||(e[11]=b(" Suivant ",-1)),u(d,{name:"heroicons:chevron-right",class:"w-4 h-4"})],8,Oe)])])):I("",!0)])])}}}),We=ae($e,[["__scopeId","data-v-61f3249f"]]);export{We as default};
