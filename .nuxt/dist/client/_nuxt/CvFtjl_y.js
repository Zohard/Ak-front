import{f as ue,v as me,g,q as ge,H as p,u as pe,G as K,h as ve,c,n as S,m as be,b as o,k as s,a as r,t as m,w as x,B as he,F as O,l as R,d as v,p as _,r as ye,e as xe,o as l,j as _e,_ as fe}from"./Bes98wj2.js";import ke from"./DwVLaoNL.js";import D from"./azFSasi8.js";import we from"./ouueNaEG.js";/* empty css        */import Ce from"./DG-nNonn.js";import qe from"./DOno_RQp.js";import{u as Me}from"./DMFesj3P.js";import{u as $e}from"./DzvRhcSF.js";import{u as Ae}from"./DX7MLR6s.js";import"./DInSo1OZ.js";const Ie={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},Te={key:0,class:"flex items-center justify-center py-20"},Se={key:1,class:"container mx-auto px-4 py-20"},De={class:"max-w-md mx-auto text-center"},Ue={class:"text-gray-600 dark:text-gray-400 mb-6"},Pe={class:"space-x-4"},Ve={key:2,class:"review-content"},Be={class:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},Ne={class:"container mx-auto px-4 py-8"},ze={class:"flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400 mb-6"},Fe={class:"text-gray-700 dark:text-gray-300"},je={class:"container mx-auto px-4 py-8"},Le={class:"grid grid-cols-1 lg:grid-cols-4 gap-8"},Ee={class:"lg:col-span-3 space-y-8"},He={class:"grid grid-cols-1 lg:grid-cols-4 gap-8"},Ke={class:"lg:col-span-1"},Oe={class:"lg:col-span-3"},Re={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"},Ge={class:"space-y-6"},Je={class:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4"},Qe={class:"flex items-center space-x-6"},We={class:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400"},Xe={class:"flex items-center space-x-1"},Ye={class:"flex items-center space-x-1"},Ze={key:0,class:"flex items-center space-x-1"},et={class:"flex flex-wrap items-center gap-4"},tt={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},rt={class:"p-8 leading-relaxed text-gray-800 dark:text-gray-200"},at=["innerHTML"],it={key:1,class:"text-gray-500 italic"},st={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},ot={class:"p-6"},nt={class:"text-center py-8 text-gray-500 dark:text-gray-400"},lt={class:"lg:col-span-1 space-y-6"},dt={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"},ct={key:0,class:"space-y-4"},ut=["onClick"],mt={class:"space-y-2"},gt={class:"text-sm font-medium text-gray-900 dark:text-white line-clamp-2 group-hover:text-blue-600 dark:group-hover:text-blue-400"},pt={class:"flex items-center justify-between"},vt={class:"text-xs text-gray-500"},bt={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},ht={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"},yt={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},xt={key:0,class:"space-y-3"},_t=["onClick"],ft={class:"font-medium text-gray-900 dark:text-white line-clamp-2 group-hover:text-blue-600 dark:group-hover:text-blue-400"},kt={class:"flex items-center justify-between mt-1"},wt={class:"text-xs text-gray-500"},Ct={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},qt={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"},Mt={class:"space-y-3"},$t=ue({__name:"ReviewDetail",setup(At){const k=me(),b=k.params.slug,a=g(null),w=g(!0),f=g(""),h=g(!1),C=g([]),q=g([]),U=g(!1),P=g(""),V=g(""),M=g(!1),B=g({title:"",text:"",url:"",image:""}),$=Me(),{getImageUrl:G}=$e(),J=ge(),A=p(()=>a.value?`${a.value.titre} - Critique par ${a.value.membre?.pseudo} - Anime-Kun`:"Critique - Anime-Kun"),I=p(()=>a.value?`${a.value.critique?.substring(0,160)||""}... - Critique de ${y(a.value)} par ${a.value.membre?.pseudo}`:"Découvrez cette critique sur Anime-Kun"),N=p(()=>{if(!a.value)return"Critique";const e=a.value.titre||a.value.title||a.value.nom||a.value.name;if(e&&e.trim())return e;const t=y(a.value);return t&&t!=="Média"?`Critique de ${t}`:"Critique sans titre"}),z=p(()=>a.value?L(a.value):null),F=_e(),j=p(()=>F.public.siteUrl?F.public.siteUrl:window.location.origin);pe({title:A,meta:[{name:"description",content:I},{property:"og:title",content:A},{property:"og:description",content:I},{property:"og:type",content:"article"},{property:"og:url",content:j.value?`${j.value}/review/${b}`:`/review/${b}`},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:A},{name:"twitter:description",content:I}]});const T=async()=>{try{w.value=!0,f.value="";const e=await $.fetchReviewById(b);a.value={idCritique:e.id||e.idCritique,niceUrl:e.niceUrl,titre:e.titre||e.title||e.nom||e.name,critique:e.critique,notation:e.notation,dateCritique:e.reviewDate||e.dateCritique,statut:e.statut||1,idMembre:e.userId||e.idMembre,idAnime:e.animeId||e.idAnime,idManga:e.mangaId||e.idManga,nbClics:e.nbClics||0,anime:e.anime,manga:e.manga,membre:e.membre?{id:e.membre.id||e.membre.idMember,pseudo:e.membre.pseudo||e.membre.memberName,avatar:e.membre.avatar}:{id:e.userId,pseudo:e.username}},await Promise.all([Q(),W()])}catch(e){f.value=e.message||"Critique introuvable"}finally{w.value=!1}},Q=async()=>{if(a.value)try{const e=a.value.idAnime||a.value.idManga,t=a.value.idAnime?"anime":"manga";if(e){const i={[t==="anime"?"idAnime":"idManga"]:e,limit:5},u=await $.fetchReviews(i),n=u.reviews||u.data||[];C.value=n.filter(d=>d.id!==a.value?.idCritique).slice(0,4).map(d=>({idCritique:d.id,niceUrl:d.niceUrl,titre:d.titre,notation:d.notation,anime:d.anime,manga:d.manga,membre:d.membre?{id:d.membre.id||d.membre.idMember,pseudo:d.membre.pseudo||d.membre.memberName}:void 0}))}}catch(e){console.error("Error loading related reviews:",e)}},W=async()=>{if(a.value?.idMembre)try{const e=await $.getUserReviews(a.value.idMembre,5),t=e.reviews||e.data||[];q.value=t.filter(i=>i.id!==a.value?.idCritique).slice(0,3).map(i=>({idCritique:i.id,niceUrl:i.niceUrl,titre:i.titre,notation:i.notation,dateCritique:i.reviewDate||i.dateCritique,membre:i.membre?{id:i.membre.id||i.membre.idMember,pseudo:i.membre.pseudo||i.membre.memberName}:void 0}))}catch(e){console.error("Error loading author reviews:",e)}},y=e=>e.manga?.titre||e.anime?.titre||"Média",L=e=>{const t=e.manga?.image||e.anime?.image,i=e.idManga?"manga":"anime";return t?G(t,i):null},E=e=>e?new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}):"",X=e=>e?e>=1e3?`${Math.floor(e/1e3)}k`:e.toString():"0",Y=()=>{if(!J.isAuthenticated){_("/login?redirect="+encodeURIComponent(k.fullPath));return}h.value=!h.value},Z=()=>{if(!a.value)return;const e={title:`Critique: ${a.value.titre}`,text:`Découvrez cette critique de ${y(a.value)} par ${a.value.membre?.pseudo||"un membre"}`,url:window.location.href,image:z.value};M.value=!0,B.value=e},ee=()=>{alert("Fonctionnalité de signalement à venir")},te=()=>{a.value&&(a.value.idAnime?_(`/anime/${a.value.idAnime}`):a.value.idManga&&_(`/manga/${a.value.idManga}`))},re=()=>{U.value=!1,P.value="",V.value=""},ae=()=>{window.print()},{setPageSEO:ie,addReviewStructuredData:se,addBreadcrumbStructuredData:oe,estimateReadingTime:ne,formatReadingTime:le}=Ae(),H=p(()=>a.value?.critique?ne(a.value.critique):0),de=p(()=>le(H.value));K(a,e=>{if(!e)return;const t=e.anime?.titre||e.manga?.titre||"Média inconnu",i=e.membre?.pseudo||"Anonyme",u=e.idManga>0?"manga":"anime",n=e.critique?e.critique.replace(/<[^>]*>/g,"").replace(/\[.*?\]/g,""):"";ie({title:`${e.titre} - Critique de ${t}`,description:n.substring(0,160)+(n.length>160?"...":""),keywords:[t,u,"critique","review","anime","manga",i,...e.tags||[]],image:L(e)||"/images/default-og.jpg",type:"article",author:i,publishedTime:e.dateCritique,section:u==="anime"?"Critiques Anime":"Critiques Manga",tags:e.tags||[t,u]}),se({title:e.titre,content:n,rating:e.notation,maxRating:10,author:i,datePublished:e.dateCritique,itemReviewed:{name:t,type:u==="anime"?"TVSeries":"Book",image:z.value,datePublished:e.anime?.annee?.toString()||e.manga?.annee?.toString(),genre:u==="anime"?e.anime?.genres:e.manga?.genres,creator:e.anime?.studio||e.manga?.auteur}}),oe([{name:"Accueil",url:"/"},{name:"Critiques",url:"/reviews"},{name:e.titre,url:`/review/${b}`}])},{immediate:!0}),ve(()=>{T()}),K(()=>k.params.slug,e=>{e&&e!==b&&T()});const ce=p(()=>{const e=a.value?.critique||"";if(!e)return"";let t=e;return t=t.replace(/\[b\](.*?)\[\/b\]/gis,"<strong>$1</strong>"),t=t.replace(/\[i\](.*?)\[\/i\]/gis,"<em>$1</em>"),t=t.replace(/\[u\](.*?)\[\/u\]/gis,"<u>$1</u>"),t=t.replace(/\[size=\d+\](.*?)\[\/size\]/gis,"$1"),t=t.replace(/\[br\]/gi,"<br>"),t=t.replace(/\r\n/g,`
`).replace(/\n/g,"<br>"),t});return(e,t)=>{const i=ye("Icon"),u=xe;return l(),c("div",Ie,[s(w)?(l(),c("div",Te,t[2]||(t[2]=[r("div",{class:"animate-spin rounded-full h-12 w-12 border-2 border-blue-500 border-t-transparent"},null,-1),r("span",{class:"ml-4 text-lg text-gray-600 dark:text-gray-300"},"Chargement de la critique...",-1)]))):s(f)?(l(),c("div",Se,[r("div",De,[o(i,{name:"heroicons:exclamation-triangle",class:"mx-auto h-12 w-12 text-red-400 mb-4"}),t[4]||(t[4]=r("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white mb-2"},"Critique introuvable",-1)),r("p",Ue,m(s(f)),1),r("div",Pe,[r("button",{onClick:T,class:"btn-primary"}," Réessayer "),o(u,{to:"/reviews",class:"btn-secondary"},{default:x(()=>t[3]||(t[3]=[v(" Retour aux critiques ",-1)])),_:1,__:[3]})])])])):s(a)?(l(),c("div",Ve,[r("div",Be,[r("div",Ne,[r("nav",ze,[o(u,{to:"/",class:"hover:text-gray-700 dark:hover:text-gray-300"},{default:x(()=>t[5]||(t[5]=[v("Accueil",-1)])),_:1,__:[5]}),o(i,{name:"heroicons:chevron-right",class:"w-4 h-4"}),o(u,{to:"/reviews",class:"hover:text-gray-700 dark:hover:text-gray-300"},{default:x(()=>t[6]||(t[6]=[v("Critiques",-1)])),_:1,__:[6]}),o(i,{name:"heroicons:chevron-right",class:"w-4 h-4"}),r("span",Fe,m(s(N)),1)])])]),r("div",je,[r("div",Le,[r("div",Ee,[r("div",He,[r("div",Ke,[o(ke,{review:s(a),"show-actions":"",onViewMedia:te},null,8,["review"])]),r("div",Oe,[r("div",Re,[r("div",Ge,[r("div",null,[r("h1",Je,m(s(N)),1),r("div",Qe,[o(D,{"model-value":s(a).notation,mode:"large","show-original-value":!0},null,8,["model-value"]),r("div",We,[r("div",Xe,[o(i,{name:"heroicons:eye",class:"w-4 h-4"}),r("span",null,m(X(s(a).nbClics))+" vues",1)]),r("div",Ye,[o(i,{name:"heroicons:clock",class:"w-4 h-4"}),r("span",null,m(E(s(a).dateCritique)),1)]),s(H)>0?(l(),c("div",Ze,[o(i,{name:"heroicons:book-open",class:"w-4 h-4"}),r("span",null,m(s(de))+" de lecture",1)])):S("",!0)])])]),o(we,{author:s(a).membre,"review-date":s(a).dateCritique,"show-follow-button":""},null,8,["author","review-date"]),r("div",et,[r("button",{onClick:Y,class:he(["flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors",s(h)?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/30"])},[o(i,{name:s(h)?"heroicons:heart-solid":"heroicons:heart",class:"w-5 h-5"},null,8,["name"]),r("span",null,m(s(h)?"Retiré des favoris":"Ajouter aux favoris"),1)],2),r("button",{onClick:Z,class:"flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-900/30 rounded-lg transition-colors"},[o(i,{name:"heroicons:share",class:"w-5 h-5"}),t[7]||(t[7]=r("span",null,"Partager",-1))]),r("button",{onClick:ee,class:"flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-yellow-100 dark:hover:bg-yellow-900/30 rounded-lg transition-colors"},[o(i,{name:"heroicons:flag",class:"w-5 h-5"}),t[8]||(t[8]=r("span",null,"Signaler",-1))])])])])])]),r("div",tt,[r("div",rt,[s(a).critique?(l(),c("div",{key:0,class:"prose prose-gray dark:prose-invert max-w-none break-words overflow-hidden",innerHTML:s(ce)},null,8,at)):(l(),c("div",it,"Aucun contenu disponible."))])]),r("div",st,[t[10]||(t[10]=r("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[r("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Commentaires ")],-1)),r("div",ot,[r("div",nt,[o(i,{name:"heroicons:chat-bubble-left",class:"mx-auto h-12 w-12 mb-3 opacity-50"}),t[9]||(t[9]=r("p",null,"Les commentaires seront bientôt disponibles",-1))])])])]),r("div",lt,[r("div",dt,[t[11]||(t[11]=r("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Autres critiques ",-1)),s(C).length?(l(),c("div",ct,[(l(!0),c(O,null,R(s(C),n=>(l(),c("div",{key:n.idCritique,class:"group cursor-pointer",onClick:d=>("navigateTo"in e?e.navigateTo:s(_))(`/review/${n.idCritique}`)},[r("div",mt,[r("h4",gt,m(n.titre),1),r("div",pt,[o(D,{"model-value":n.notation,mode:"compact",size:"sm"},null,8,["model-value"]),r("span",vt,m(n.membre?.pseudo),1)])])],8,ut))),128))])):(l(),c("div",bt," Aucune critique similaire trouvée "))]),r("div",ht,[r("h3",yt," Plus de "+m(s(a).membre?.pseudo),1),s(q).length?(l(),c("div",xt,[(l(!0),c(O,null,R(s(q),n=>(l(),c("div",{key:n.idCritique,class:"group cursor-pointer text-sm",onClick:d=>("navigateTo"in e?e.navigateTo:s(_))(`/review/${n.idCritique}`)},[r("h4",ft,m(n.titre),1),r("div",kt,[o(D,{"model-value":n.notation,mode:"compact",size:"sm"},null,8,["model-value"]),r("span",wt,m(E(n.dateCritique)),1)])],8,_t))),128))])):(l(),c("div",Ct," Aucune autre critique de cet auteur "))]),r("div",qt,[t[13]||(t[13]=r("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Actions rapides ",-1)),r("div",Mt,[o(u,{to:`/reviews?search=${y(s(a))}`,class:"block w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors"},{default:x(()=>[o(i,{name:"heroicons:magnifying-glass",class:"w-4 h-4 inline mr-2"}),v(" Voir toutes les critiques de "+m(y(s(a))),1)]),_:1},8,["to"]),o(u,{to:`/reviews?author=${s(a).membre?.pseudo}`,class:"block w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors"},{default:x(()=>[o(i,{name:"heroicons:user",class:"w-4 h-4 inline mr-2"}),v(" Voir toutes les critiques de "+m(s(a).membre?.pseudo),1)]),_:1},8,["to"]),r("button",{onClick:ae,class:"block w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors"},[o(i,{name:"heroicons:printer",class:"w-4 h-4 inline mr-2"}),t[12]||(t[12]=v(" Imprimer cette critique ",-1))])])])])])])])):S("",!0),s(U)?(l(),be(Ce,{key:3,"image-src":s(P),"image-alt":s(V),onClose:re},null,8,["image-src","image-alt"])):S("",!0),o(qe,{show:s(M),"share-data":s(B),onClose:t[0]||(t[0]=n=>M.value=!1),onShared:t[1]||(t[1]=n=>console.log("Shared to:",n))},null,8,["show","share-data"])])}}}),jt=fe($t,[["__scopeId","data-v-fc5710b1"]]);export{jt as default};
