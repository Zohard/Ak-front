import H from"./Cm87hVzY.js";import{f as O,u as G,v as K,s as W,H as J,g as u,i as Q,G as X,h as Y,c as o,a as s,t as d,k as l,n as f,d as B,F as C,l as U,j as Z,o as a,m as ee,p as I,_ as te}from"./Bes98wj2.js";import{u as se}from"./DzvRhcSF.js";import{u as ae}from"./BUUJWTKH.js";import{u as ne}from"./CYnEU-cf.js";import{u as oe}from"./DKV7c2p8.js";const re={class:"main-content"},le={class:"page-header mb-6"},ie={class:"text-gray-600 dark:text-gray-300"},ce={class:"space-y-10"},ue={class:"flex items-center justify-between mb-4"},de={key:0,class:"text-sm text-gray-500"},ge={key:0,class:"flex items-center gap-2 text-gray-500"},me={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},pe=["onClick"],ve={class:"aspect-[20/21] overflow-hidden"},fe=["src","alt"],he={key:1,class:"w-full h-full bg-gray-200 dark:bg-gray-700"},ye={class:"p-3"},_e={class:"font-semibold text-text line-clamp-2"},xe={class:"text-sm text-text-secondary mt-1"},be={key:0},ke={key:1},we={key:2,class:"text-sm text-gray-500"},Ae={class:"flex items-center justify-between mb-4"},$e={key:0,class:"text-sm text-gray-500"},Be={key:0,class:"flex items-center gap-2 text-gray-500"},Ce={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},Ue={key:2,class:"text-sm text-gray-500"},Ie={class:"flex items-center justify-between mb-4"},Te={key:0,class:"text-sm text-gray-500"},Me={key:0,class:"flex items-center gap-2 text-gray-500"},Se={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},je=["onClick"],qe={class:"w-16 h-20 rounded overflow-hidden flex-shrink-0","data-avatar":""},Re=["src","alt"],Ee={class:"flex-1 min-w-0"},Fe={class:"font-medium text-text truncate"},Le={class:"text-xs text-text-secondary capitalize"},Pe={key:2,class:"text-sm text-gray-500"},Ve=O({__name:"search",setup(ze){G({title:"Recherche - Anime-Kun"});const S=K();W();const T=Z(),{getImageUrl:j}=se(),A=J(()=>String(S.query.q||"").trim()),m=u([]),h=u(null),b=u(!1),p=u([]),y=u(null),k=u(!1),v=u([]),_=u(null),w=u(!1),q=ae(),R=ne(),E=t=>t?t.startsWith("http")?t:`${(T.public.apiBase||"").replace(/\/$/,"")}/media/business/${t}`:"";let i=0,c=!0;Q(()=>{c=!1});const M=async()=>{const t=++i,e=A.value;if(!e){if(!c||t!==i)return;m.value=[],p.value=[],v.value=[],h.value=y.value=_.value=0;return}if(!c||t!==i)return;b.value=k.value=w.value=!0;const n=(T.public.apiBase||"").replace(/\/$/,""),g=q.fetchAnimes({search:e,limit:16,sortBy:"titre",sortOrder:"asc"}).then(r=>{if(!c||t!==i)return;const x=Array.isArray(r?.animes)?r.animes:Array.isArray(r?.data)?r.data:Array.isArray(r)?r:[];m.value=x;const D=r.pagination||r.meta;h.value=D?.total??m.value?.length??0,b.value=!1}).catch(()=>{!c||t!==i||(m.value=[],h.value=0,b.value=!1)}),z=R.fetchMangas({search:e,limit:16,sortBy:"titre",sortOrder:"asc"}).then(r=>{if(!c||t!==i)return;p.value=r.mangas||r.data||[];const x=r.pagination||r.meta;y.value=x?.total??p.value?.length??0,k.value=!1}).catch(()=>{!c||t!==i||(p.value=[],y.value=0,k.value=!1)}),N=$fetch(`${n}/api/business`,{params:{search:e,limit:16}}).then(r=>{if(!c||t!==i)return;v.value=r.data||r.businesses||[];const x=r.pagination||r.meta;_.value=x?.total??v.value?.length??0,w.value=!1}).catch(()=>{!c||t!==i||(v.value=[],_.value=0,w.value=!1)});await Promise.allSettled([g,z,N])},$=t=>t.toLowerCase().replace(/[àáâãäå]/g,"a").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/[ýÿ]/g,"y").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),F=t=>{const e=t.niceUrl||$(t.titre);I(`/anime/${e}-${t.id}`)},L=t=>{const e=t.niceUrl||$(t.titre);I(`/manga/${e}-${t.id}`)},P=t=>{const e=t.niceUrl||$(t.denomination||"business");I(`/business/${e}-${t.idBusiness}`)},V=oe(()=>{M()},200);return X(A,()=>{V()}),Y(()=>{M()}),(t,e)=>(a(),o("div",re,[s("div",le,[e[2]||(e[2]=s("h1",{class:"section-title text-2xl font-bold"},"Recherche",-1)),s("p",ie,'Résultats pour "'+d(l(A))+'"',1)]),s("div",ce,[s("section",null,[s("div",ue,[e[3]||(e[3]=s("h2",{class:"text-xl font-semibold"},"Animes",-1)),l(h)!==null?(a(),o("span",de,d(l(h))+" résultats",1)):f("",!0)]),l(b)?(a(),o("div",ge,e[4]||(e[4]=[s("span",{class:"animate-spin rounded-full h-4 w-4 border-2 border-blue-500 border-t-transparent"},null,-1),B(" Chargement des animes... ",-1)]))):l(m).length?(a(),o("div",me,[(a(!0),o(C,null,U(l(m),n=>(a(),o("div",{key:n.id,class:"group relative bg-surface rounded-xl overflow-hidden shadow-card hover:shadow-card-hover transition-all duration-300 hover:-translate-y-0.5 cursor-pointer",onClick:g=>F(n)},[s("div",ve,[n.image?(a(),o("img",{key:0,src:l(j)(n.image,"anime"),alt:n.titre,class:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105",loading:"lazy",onError:e[0]||(e[0]=g=>g.target.style.display="none")},null,40,fe)):(a(),o("div",he))]),s("div",ye,[s("div",_e,d(n.titre),1),s("div",xe,[n.annee?(a(),o("span",be,d(n.annee),1)):f("",!0),n.nbEp?(a(),o("span",ke," • "+d(n.nbEp)+" ép.",1)):f("",!0)])])],8,pe))),128))])):(a(),o("div",we,"Aucun anime trouvé."))]),s("section",null,[s("div",Ae,[e[5]||(e[5]=s("h2",{class:"text-xl font-semibold"},"Mangas",-1)),l(y)!==null?(a(),o("span",$e,d(l(y))+" résultats",1)):f("",!0)]),l(k)?(a(),o("div",Be,e[6]||(e[6]=[s("span",{class:"animate-spin rounded-full h-4 w-4 border-2 border-blue-500 border-t-transparent"},null,-1),B(" Chargement des mangas... ",-1)]))):l(p).length?(a(),o("div",Ce,[(a(!0),o(C,null,U(l(p),n=>(a(),ee(H,{key:n.id,manga:n,onView:L},null,8,["manga"]))),128))])):(a(),o("div",Ue,"Aucun manga trouvé."))]),s("section",null,[s("div",Ie,[e[7]||(e[7]=s("h2",{class:"text-xl font-semibold"},"Business",-1)),l(_)!==null?(a(),o("span",Te,d(l(_))+" résultats",1)):f("",!0)]),l(w)?(a(),o("div",Me,e[8]||(e[8]=[s("span",{class:"animate-spin rounded-full h-4 w-4 border-2 border-blue-500 border-t-transparent"},null,-1),B(" Chargement… ",-1)]))):l(v).length?(a(),o("div",Se,[(a(!0),o(C,null,U(l(v),n=>(a(),o("div",{key:n.idBusiness,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 flex gap-3 items-center cursor-pointer hover:shadow-md transition",onClick:g=>P(n)},[s("div",qe,[n.image?(a(),o("img",{key:0,src:E(n.image),alt:n.denomination||"Avatar",class:"w-full h-full object-cover",onError:e[1]||(e[1]=g=>g.target.style.display="none")},null,40,Re)):f("",!0)]),s("div",Ee,[s("div",Fe,d(n.denomination||"Sans nom"),1),s("div",Le,d(n.type||"business"),1)])],8,je))),128))])):(a(),o("div",Pe,"Aucun résultat business."))])])]))}}),We=te(Ve,[["__scopeId","data-v-73882a9c"]]);export{We as default};
